<odoo>
    <record id="product_descontrol_form_view" model="ir.ui.view">
        <field name="name">product.descontrol.form.view</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_form_view"/>
        <field name="arch" type="xml">
          <xpath expr="//field[@name='categ_id']" position="after">
            <field  name="isbn_number" string="ISBN"/>
            <field name="author_name" widget="many2many_tags"/>
            <field name="product_tags" widget="many2many_tags" string="Etiquetas"/>
          </xpath>
          <xpath expr="//field[@name='taxes_id']" position="after">
            <field name="producto_referencia" widget="one2many_tags"
              optional="show" string="Libro de referencia"
              attrs="{'invisible': [('view_show_ddaa_fields', '==', False)]}"
            />
          </xpath>
          <!-- <xpath expr="//field[@name='taxes_id']" position="after">
            <field name="prod_ref"
              optional="show" string="prod ref"
              attrs="{'invisible': [('view_show_ddaa_fields', '==', False)]}"
              readonly="1"
            />
          </xpath> -->
          <xpath expr="//field[@name='taxes_id']" position="after">
            <field name="receptora_derecho_autoria" widget="many2many_tags"
              optional="show" string="Receptor derechos autoría"
              attrs="{'invisible': [('view_show_ddaa_fields', '==', False)]}"
            />
          </xpath>
          <xpath expr="//field[@name='taxes_id']" position="after">
            <field name="view_show_ddaa_fields"
              attrs="{'invisible': 1}"
            />
          </xpath>
          <xpath expr="//field[@name='taxes_id']" position="after">
            <field name="view_show_genera_ddaa_fields"
              attrs="{'invisible': 1}"
            />
          </xpath>
          <!-- TODO: este campo no funciona como lista -->
          <xpath expr="//field[@name='taxes_id']" position="after">
            <field name="derecho_autoria"
              optional="show" string="Referencia a derecho de autoría"
              attrs="{'invisible': [('view_show_genera_ddaa_fields', '==', False)]}"
            />
          </xpath>
          <xpath expr="//field[@name='taxes_id']" position="after">
            <field name="genera_ddaa"
              optional="show" string="Genera derechos de autoría"
              attrs="{'invisible': [('view_show_genera_ddaa_fields', '==', False)]}"
            />
          </xpath>

          <xpath expr="//group[@name='purchase']" position="before">
              <field name="limited_visibility_by_provider"/>
              <label for="limited_visibility_by_provider"/>
          </xpath>
 
        </field>
    </record>
    <menuitem
      id="main_menu_product"
      name="Productos"
      sequence="1"
      action="sale.product_template_action"
      web_icon="product,static/description/logo-devcontrol.png"
      groups="base.group_user"/>

    <!-- view used for product.product only -->
    <record model="ir.ui.view" id="product_form_view_procurement_button_replace">
      <field name="name">product.product.procurement</field>
      <field name="model">product.product</field>
      <field name="groups_id" eval="[(4, ref('stock.group_stock_user'))]"/>
      <field name="inherit_id" ref="product.product_normal_form_view"/>
      <field name="arch" type="xml">

        <xpath expr="//button[@name='action_open_quants'][1]" position="replace">
          <button class="oe_stat_button"
            icon="fa-folder-open"
            attrs="{'invisible':[('type', '!=', 'product')]}">
            <div class="o_field_widget o_stat_info">
              <span class="o_stat_value">
                <field name="owned_qty" widget="integer" digits="[12,0]" nolabel="1" class="mr4"/>
                <field name="uom_name"/>
              </span>
              <span class="o_stat_text">Existencias totales</span>
            </div>
            </button>
        </xpath>

        <xpath expr="//button[@name='action_product_forecast_report'][1]" position="replace">
          <button
              attrs="{'invisible':[('type', '!=', 'product')]}"
              context="{'default_product_id': id}"
              class="oe_stat_button" icon="fa-cubes">
              <div class="o_field_widget o_stat_info">
                <span class="o_stat_value">
                  <field name="on_hand_qty" widget="integer" digits="[12,0]" nolabel="1" class="mr4"/>
                  <field name="uom_name"/>
                </span>
                <span class="o_stat_text">En almacén</span>
              </div>
          </button>
        </xpath>

        <xpath expr="//button[@name='action_view_stock_move_lines']" position="before">
          <button
              attrs="{'invisible':[('type', '!=', 'product')]}"
              context="{'default_product_id': id}"
              class="oe_stat_button" icon="fa-building">
              <div class="o_field_widget o_stat_info">
                <span class="o_stat_value">
                  <field name="in_distribution_qty" widget="integer" digits="[12,0]" nolabel="1" class="mr4"/>
                  <field name="uom_name"/>
                </span>
                <span class="o_stat_text">En distribución</span>
              </div>
          </button>        
        </xpath>

        <xpath expr="//button[@name='action_view_stock_move_lines']" position="before">
          <button
              attrs="{'invisible':[('type', '!=', 'product')]}"
              context="{'default_product_id': id}"
              class="oe_stat_button" icon="fa-archive">
              <div class="o_field_widget o_stat_info">
                <span class="o_stat_value">
                  <field name="purchase_deposit_qty" widget="integer" digits="[12,0]" nolabel="1" class="mr4"/>
                  <field name="uom_name"/>
                </span>
                <span class="o_stat_text">Depósito compra</span>
              </div>
          </button>        
        </xpath>

        <xpath expr="//button[@name='action_view_stock_move_lines']" position="before">
          <button
              attrs="{'invisible':[('type', '!=', 'product')]}"
              context="{'default_product_id': id}"
              class="oe_stat_button" icon="fa-truck">
              <div class="o_field_widget o_stat_info">
                <span class="o_stat_value">
                  <field name="received_qty" widget="integer" digits="[12,0]" nolabel="1" class="mr4"/>
                  <field name="uom_name"/>
                </span>
                <span class="o_stat_text">Recibidos</span>
              </div>
          </button>        
        </xpath>

        <xpath expr="//button[@name='action_view_stock_move_lines']" position="before">
          <button
              attrs="{'invisible':[('type', '!=', 'product')]}"
              context="{'default_product_id': id}"
              class="oe_stat_button" icon="fa-shopping-cart">
              <div class="o_field_widget o_stat_info">
                <span class="o_stat_value">
                  <field name="liquidated_purchases_qty" widget="integer" digits="[12,0]" nolabel="1" class="mr4"/>
                  <field name="uom_name"/>
                </span>
                <span class="o_stat_text">Compras liquidadas</span>
              </div>
          </button>        
        </xpath>

      </field>
    </record>


    <!-- view used for product.template only -->
    <record model="ir.ui.view" id="product_template_form_view_procurement_button_replace">
      <field name="name">product.template_procurement</field>
      <field name="model">product.template</field>
      <field name="groups_id" eval="[(4, ref('stock.group_stock_user'))]"/>
      <field name="inherit_id" ref="product.product_template_only_form_view"/>
      <field name="arch" type="xml">
        <xpath expr="//button[@name='action_open_quants'][1]" position="replace">
          <button
              attrs="{'invisible':[('type', '!=', 'product')]}"
              class="oe_stat_button" icon="fa-folder-open">
              <div class="o_field_widget o_stat_info">
                <span class="o_stat_value">
                  <field name="owned_qty" widget="integer" digits="[12,0]" nolabel="1" class="mr4" col="2"/>
                  <field name="uom_name"/>
                </span>
                <span class="o_stat_text">Existencias totales</span>
              </div>
          </button>
        </xpath>

        <xpath expr="//button[@name='action_product_tmpl_forecast_report'][1]" position="replace">
          <button
              attrs="{'invisible':[('type', '!=', 'product')]}"
              context="{'default_product_tmpl_id': id}"
              class="oe_stat_button" icon="fa-cubes">
              <div class="o_field_widget o_stat_info">
                <span class="o_stat_value" widget="statinfo">
                  <field name="on_hand_qty" widget="integer" digits="[12,0]" nolabel="1" class="mr4" col="2"/>
                  <field name="uom_name"/>
                </span>
                <span class="o_stat_text">En almacén</span>
              </div>
          </button>
        </xpath>

        <xpath expr="//button[@name='action_view_stock_move_lines']" position="before">
          <button
              attrs="{'invisible':[('type', '!=', 'product')]}"
              context="{'default_product_tmpl_id': id}"
              class="oe_stat_button" icon="fa-building">
              <div class="o_field_widget o_stat_info">
                <span class="o_stat_value" widget="statinfo">
                  <field name="in_distribution_qty" widget="integer" digits="[12,0]" nolabel="1" class="mr4" col="2"/>
                  <field name="uom_name"/>
                </span>
                <span class="o_stat_text">En distribución</span>
              </div>
          </button>        
        </xpath>

        <xpath expr="//button[@name='action_view_stock_move_lines']" position="before">
          <button
              attrs="{'invisible':[('type', '!=', 'product')]}"
              context="{'default_product_id': id}"
              class="oe_stat_button" icon="fa-archive">
              <div class="o_field_widget o_stat_info">
                <span class="o_stat_value">
                  <field name="purchase_deposit_qty" widget="integer" digits="[12,0]" nolabel="1" class="mr4"/>
                  <field name="uom_name"/>
                </span>
                <span class="o_stat_text">Depósito compra</span>
              </div>
          </button>        
        </xpath>

        <xpath expr="//button[@name='action_view_stock_move_lines']" position="before">
          <button
              attrs="{'invisible':[('type', '!=', 'product')]}"
              context="{'default_product_id': id}"
              class="oe_stat_button" icon="fa-truck">
              <div class="o_field_widget o_stat_info">
                <span class="o_stat_value">
                  <field name="received_qty" widget="integer" digits="[12,0]" nolabel="1" class="mr4"/>
                  <field name="uom_name"/>
                </span>
                <span class="o_stat_text">Recibidos</span>
              </div>
          </button>        
        </xpath>

        <xpath expr="//button[@name='action_view_stock_move_lines']" position="before">
          <button
              attrs="{'invisible':[('type', '!=', 'product')]}"
              context="{'default_product_id': id}"
              class="oe_stat_button" icon="fa-shopping-cart">
              <div class="o_field_widget o_stat_info">
                <span class="o_stat_value">
                  <field name="liquidated_purchases_qty" widget="integer" digits="[12,0]" nolabel="1" class="mr4"/>
                  <field name="uom_name"/>
                </span>
                <span class="o_stat_text">Compras liquidadas</span>
              </div>
          </button>        
        </xpath>

      </field>
    </record>

      
    <record model="ir.ui.view" id="product_form_view_sale_order_button_replace">
      <field name="name">product.product.sale.order</field>
      <field name="model">product.product</field>
      <field name="inherit_id" ref="product.product_normal_form_view"/>
      <field name="groups_id" eval="[(4, ref('stock.group_stock_user'))]"/>
      <field name="arch" type="xml">
        <xpath expr="//button[@name='action_view_sales'][1]" position="replace">
        </xpath>
        <xpath expr="//button[@name='action_view_stock_move_lines']" position="before">
          <button 
              attrs="{'invisible':[('type', '!=', 'product')]}"
              class="oe_stat_button" icon="fa-eur">
              <div class="o_field_widget o_stat_info">
                  <span class="o_stat_value">
                      <field name="liquidated_qty" widget="integer" digits="[12,0]" nolabel="1" class="mr4"/>
                      <field name="uom_name"/>
                  </span>
                  <span class="o_stat_text">Ventas liquidadas</span>
              </div>
            </button>
          </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="product_template_form_view_sale_order_button_replace">
      <field name="name">product.template.sale.order.button</field>
      <field name="model">product.template</field>
      <field name="inherit_id" ref="product.product_template_only_form_view"/>
      <field name="groups_id" eval="[(4, ref('stock.group_stock_user'))]"/>
      <field name="arch" type="xml">
        <xpath expr="//button[@name='action_view_sales'][1]" position="replace">
        </xpath>
        <xpath expr="//button[@name='action_view_stock_move_lines']" position="before">
          <button 
              attrs="{'invisible':[('type', '!=', 'product')]}" name="action_view_sales"
              class="oe_stat_button" icon="fa-eur">
              <div class="o_field_widget o_stat_info">
                  <span class="o_stat_value">
                      <field name="liquidated_qty" widget="integer" digits="[12,0]" nolabel="1" class="mr4" col="2"/>
                      <field name="uom_name"/>
                  </span>
                  <span class="o_stat_text">Ventas liquidadas</span>
              </div>
          </button>
        </xpath> 
      </field>
    </record>

    <!--Remueve botón de comprados en vista product.template-->
    <record id="view_product_template_purchase_buttons_from_replace" model="ir.ui.view">
      <field name="name">product.template.purchase.button.inherit</field>
      <field name="model">product.template</field>
      <field name="inherit_id" ref="product.product_template_only_form_view"/>
      <field name="groups_id" eval="[(4, ref('purchase.group_purchase_user'))]"/>
      <field name="arch" type="xml">
        <xpath expr="//button[@name='action_view_po'][1]" position="replace">
        </xpath>
      </field>
    </record>

    <!--Remueve botón de comprados en vista product.product-->
    <record id="product_normal_form_view_inherit_purchase" model="ir.ui.view">
        <field name="name">product.product.purchase.order.inherit</field>
        <field name="model">product.product</field>
        <field name="inherit_id" ref="product.product_normal_form_view"/>
        <field name="arch" type="xml">
          <xpath expr="//button[@name='action_view_po'][1]" position="replace">
          </xpath>
        </field>
    </record>

    <record id="view_stock_product_tree_replace" model="ir.ui.view">
        <field name="name">product.stock.tree.inherit</field>
        <field name="model">product.product</field>
        <field name="inherit_id" ref="product.product_product_tree_view"/>
        <field name="arch" type="xml">
        <xpath expr="//tree" position="attributes">
            <attribute name="decoration-danger">type == 'product' and owned_qty &lt; 0</attribute>
            <attribute name="decoration-info">type != 'product' or owned_qty &gt;= 0</attribute>
        </xpath>
          <xpath expr="//field[@name='qty_available'][1]" position="replace">
            <field name="on_hand_qty" attrs="{'invisible':[('type', '!=', 'product')]}" optional="show"/>
          </xpath>
          <xpath expr="//field[@name='virtual_available'][1]" position="replace">
            <field name="owned_qty" attrs="{'invisible':[('type', '!=', 'product')]}" string="Existencias totales" optional="show"/>
          </xpath>
        </field>
    </record>

    <record id="view_stock_product_template_tree_replace" model="ir.ui.view">
        <field name="name">product.template.stock.tree.inherit</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_tree_view"/>
        <field name="arch" type="xml">
        <xpath expr="//tree" position="attributes">
            <attribute name="decoration-danger">type == 'product' and owned_qty &lt; 0</attribute>
            <attribute name="decoration-info">type != 'product' or owned_qty &gt;= 0</attribute>
        </xpath>
          <xpath expr="//field[@name='qty_available'][1]" position="replace">
              <field name="on_hand_qty" attrs="{'invisible':[('type', '!=', 'product')]}" optional="show"/>
          </xpath>          
          <xpath expr="//field[@name='virtual_available'][1]" position="replace">
            <field name="owned_qty" attrs="{'invisible':[('type', '!=', 'product')]}" optional="show"/>
          </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="editorial_product_template_kanban_stock_view">
        <field name="name">Editorial Product Template Kanban Stock</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_kanban_view"/>
        <field name="arch" type="xml">
          <xpath expr="//li[field/@name='qty_available']" position="replace"/>
          <xpath expr="//ul" position="inside">
              <div>En almacén: <field name="on_hand_qty"/> <field name="uom_id"/></div>
          </xpath>
        </field>
    </record>

    <record id="product_product_view_form_easy_inherit_stock_editorial" model="ir.ui.view">
        <field name="name">product.product.view.form.easy.inherit.stock.editorial</field>
        <field name="model">product.product</field>
        <field name="inherit_id" ref="stock.product_product_view_form_easy_inherit_stock"/>
        <field name="arch" type="xml">
          <xpath expr="//button[@name='action_update_quantity_on_hand']" position="attributes">
            <attribute name="attrs">{'invisible': 1}</attribute>
          </xpath>
        </field>
    </record>
    <record id="product_form_view_procurement_button_editorial" model="ir.ui.view">
        <field name="name">product.product.procurement.editorial</field>
        <field name="model">product.product</field>
        <field name="inherit_id" ref="stock.product_form_view_procurement_button"/>
        <field name="arch" type="xml">
          <xpath expr="//button[@name='action_update_quantity_on_hand']" position="attributes">
            <attribute name="attrs">{'invisible': 1}</attribute>
          </xpath>
          <!-- Hide Replenish button -->
          <xpath expr="//button[@name='%(stock.action_product_replenish)d']" position="attributes">
            <attribute name="attrs">{'invisible': 1}</attribute>
          </xpath>
        </field>
    </record>
    <record id="product_template_form_view_procurement_button_editorial" model="ir.ui.view">
        <field name="name">product.template_procurement.editorial</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="stock.product_template_form_view_procurement_button"/>
        <field name="arch" type="xml">
          <xpath expr="//button[@name='action_update_quantity_on_hand']" position="attributes">
            <attribute name="attrs">{'invisible': 1}</attribute>
          </xpath>
          <!-- Hide Replenish button -->
          <xpath expr="//button[@name='%(stock.action_product_replenish)d']" position="attributes">
            <attribute name="attrs">{'invisible': 1}</attribute>
          </xpath>
        </field>
    </record>
</odoo>
