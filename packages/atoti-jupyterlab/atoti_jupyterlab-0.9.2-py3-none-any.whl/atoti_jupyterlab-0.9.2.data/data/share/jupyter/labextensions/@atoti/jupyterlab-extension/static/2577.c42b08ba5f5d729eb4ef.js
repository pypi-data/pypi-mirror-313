"use strict";(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[2577,5274],{53088:(e,t,o)=>{o.d(t,{y:()=>r});var n=o(42405);const r=({label:e={label:""},insertText:t,kind:o=n.languages.CompletionItemKind.Constant,...r})=>({label:e,kind:o,insertText:void 0!==t?t:"string"==typeof e?e:e.label,range:void 0,...r})},7106:(e,t,o)=>{o.r(t),o.d(t,{default:()=>F});var n=o(74389),r=o(40570),a=o(93345),s=o(95889),i=o(61181),l=o(367),d=o(31529),u=o(42405),m=o(91397),c=o(31003),g=o(53088);const p=e=>(e=>{const t=e.matchAll(/Member (?<calculatedMemberUniqueName>.*) AS/gim),o=new Set;for(const e of t){const t=e?.groups?.calculatedMemberUniqueName;t&&o.add(t)}return Array.from(o)})(e).map((e=>{const[{groups:t={}}={}]=e.matchAll(/(\[Measures]).(?:(\[(?<quotedMeasure>.*)\])|(?<unquotedMeasure>\w*))/gi);return t.unquotedMeasure??t.quotedMeasure})).filter(Boolean),f=(e,t,o=0)=>e.getValueInRange({startColumn:0,endColumn:t.column,startLineNumber:t.lineNumber-o,endLineNumber:t.lineNumber}),A={getSuggestions:({position:e,textModel:t,cube:o,dataModel:n,formatMessage:r})=>{const a=f(t,e);if(a.toLowerCase().includes("from "))return[];const s=a.match(/\[[^\]]*\]?(?:\.(?:\[[^\]]*\]?|\w*))*$/gim)?.at(-1);if(!s)return[];const[l,A,b,h]=(s||"").split(".").map((e=>e.replace(/\[([^\]]*)\]?/,"$1"))),y=o?[o]:n?(0,m.X)(n):[];if((0,c.t)({dimensionName:l}))return(({cubes:e,textModel:t,formatMessage:o})=>[...(0,d.flatMap)(e,(({name:e,measures:t})=>Object.keys(t).map((t=>(0,g.y)({label:{label:t,description:e}}))))),...p(t.getValue()).map(((e="")=>(0,g.y)({label:{label:e,description:o({id:"aui.mdxEditor.autoCompletion.calculatedMeasure"})}})))])({cubes:y,textModel:t,formatMessage:r});if(void 0===A)return(e=>[(0,g.y)({kind:u.languages.CompletionItemKind.Unit,label:"Measures",preselect:!0}),...(0,d.flatMap)(e,(({name:e,dimensions:t})=>Object.keys(t).map((t=>(0,g.y)({label:{label:t,description:e}})))))])(y);if(void 0===b)return(({cubes:e,dimensionName:t})=>(0,d.flatMap)(e,(({name:e,dimensions:o})=>{const n=o[t]?.hierarchies??{};return Object.keys(n).map((o=>(0,g.y)({label:{label:o,description:`${e}/${t}`}})))})))({cubes:y,dimensionName:l});if(void 0===h)return(({cubes:e,dimensionName:t,hierarchyName:o})=>[(0,g.y)({label:{label:"AllMember",description:`${t}/${o}`},preselect:!0}),...(0,d.flatMap)(e,(({name:e,dimensions:n})=>{const r=n[t]?.hierarchies[o]?.levels??{};return Object.keys(r).map((n=>(0,g.y)({label:{label:n,description:`${e}/${t}/${o}`}})))}))])({cubes:y,dimensionName:l,hierarchyName:A});const M="ALL"===b?[(0,g.y)({label:{label:"AllMember",description:`${l}/${A}`},preselect:!0})]:[];return M.push(...i.memberPropertyKeywords.map((e=>(0,g.y)({label:e,kind:u.languages.CompletionItemKind.Property,sortText:"zzz"})))),M}},b={getSuggestions:({position:e,textModel:t,cube:o,dataModel:n})=>{if(null===f(t,e,1).match(new RegExp(`(${i.kpiKeywords.join("|")})[(][^)]*`,"i")))return[];const r=o?[o]:n?(0,m.X)(n):[];return(0,d.flatMap)(r,(({name:e,kpis:t})=>Object.keys(t).map((t=>(0,g.y)({kind:u.languages.CompletionItemKind.Event,label:{label:t,description:e}})))))}},h={getSuggestions:({position:e,textModel:t})=>null!==f(t,e).match(/(\bON\b\s*)([\w]*)$/i)?i.axisKeywords.map((e=>(0,g.y)({label:e}))):[]},y={getSuggestions:({position:e,textModel:t,cube:o,dataModel:n})=>{const r=f(t,e).match(/(FROM\s+)(\[)([^\]]*)(?<CB>\])*/i);return null!==r&&void 0===r.groups?.CB?(o?[o]:n?(0,m.X)(n):[]).map((({name:e})=>(0,g.y)({kind:u.languages.CompletionItemKind.Interface,label:e}))):[]}},M=({position:e,textModel:t,cube:o,dataModel:n,formatMessage:r})=>{const a=(0,d.flatMap)([y,h,A,b],(({getSuggestions:a})=>a({position:e,textModel:t,cube:o,dataModel:n,formatMessage:r})));return a.length>0?a:[...[...i.functionKeywords,...i.kpiKeywords,...i.memberPropertyKeywords,...i.argumentKeywords].map((e=>(0,g.y)({kind:u.languages.CompletionItemKind.Function,label:e}))),...[...i.axisKeywords].map((e=>(0,g.y)({kind:u.languages.CompletionItemKind.EnumMember,label:e}))),...[...i.booleanKeywords,...i.booleanOperatorKeywords].map((e=>(0,g.y)({kind:u.languages.CompletionItemKind.Operator,label:e}))),...[...i.structuralKeywords,...i.cellPropertyKeywords].map((e=>(0,g.y)({kind:u.languages.CompletionItemKind.Keyword,label:e})))]},w=e=>(0,d.flatMap)(e,(e=>Object.values(e.measures))),x=e=>(0,d.flatMap)(e,(e=>Object.values(e.dimensions))),v=(e,t)=>{const o=e.find((e=>e.dimensions[t])),n=o?.dimensions[t];return n?Object.values(n.hierarchies):[]},N="#faad14",C=({classNames:e={},textModel:t,offset:o,options:n={},length:r,type:a})=>{const s={error:{color:"red",className:e.line_error,position:4,zIndex:10},warning:{color:N,className:e.line_warning,position:1,zIndex:1}};return{range:u.Range.fromPositions(t.getPositionAt(o),t.getPositionAt(o+r)),options:{overviewRuler:{color:s[a].color,position:s[a].position},inlineClassName:s[a].className,zIndex:s[a].zIndex,...n}}},k=(e="",t=[])=>t.reduce(((t,o)=>{const n=((e="",t="")=>{if(e.length<2||t.length<2)return 0;const o=new Map;for(let t=0;t<e.length-1;t++){const n=e.substr(t,2);o.set(n,o.get(n)??1)}let n=0;for(let e=0;e<t.length-1;e++){const r=t.substr(e,2),a=o.get(r)??0;a>0&&(o.set(r,a-1),n++)}return 2*n/(e.length+t.length-2)})(o,e);return t.coefficient<n?{hint:o,coefficient:n}:t}),{hint:"",coefficient:0}),K=({header:e="",body:t="",hint:o={coefficient:0,hint:""},formatMessage:n=(()=>"")})=>{const r=[{value:`#### **${e}**`}];return o.coefficient>.65&&r.push({value:`${n({id:"aui.mdxEditor.hover.didYouMean"})}: ***${o.hint}?***`,isTrusted:!0}),r.push({value:t}),r},$={getDecorations:({textModel:e,mdxErrorDetails:t,classNames:o,formatMessage:n=(()=>"")})=>{if(!t)return[];const r=((e,t)=>{const o=u.editor.createModel(e);try{if(t.from.ch>=0){const e=o.getValueInRange(new u.Range(t.from.line+1,t.from.ch,t.to.line+1,o.getLineLastNonWhitespaceColumn(t.to.line+1))),n=e.length-e.trimLeft().length;return new u.Range(t.from.line+1,t.from.ch+n,t.to.line+1,t.to.ch+n)}return new u.Range(t.from.line,o.getLineLastNonWhitespaceColumn(t.from.line),t.to.line+1,o.getLineFirstNonWhitespaceColumn(t.to.line+1)+t.text.length)}catch{return new u.Range(0,0,0,0)}})(e.getValue(),t),a=e.getOffsetAt(r.getStartPosition());return[C({type:"error",classNames:o,textModel:e,offset:a,length:e.getOffsetAt(r.getEndPosition())-a,options:{hoverMessage:K({header:`${n({id:"aui.mdxEditor.hover.errorOnLine"})} ***${r.startLineNumber}***`,body:`${n({id:"aui.mdxEditor.hover.availableOptionsAre"})} : \n${t.expected?.map((e=>`- ${e}`)).join("\n")}`,hint:k(t.text,t.expected?.map((e=>e.replace(/'/g,"")))),formatMessage:n})}})]}},E={getDecorations:({textModel:e,classNames:t,formatMessage:o=(()=>"")})=>{const n=e.getValue().matchAll(/(?<function>\w+)\(/gi),r=[...i.functionKeywords,...i.kpiKeywords],a=[];for(const s of n)s.index&&!["FROM",...r].map((e=>e.toLowerCase())).includes((s.groups?.function??"").toLowerCase())&&a.push(C({type:"warning",classNames:t,textModel:e,offset:s.index,length:s[0]?.length,options:{hoverMessage:K({header:`${o({id:"aui.mdxEditor.hover.unknownFunction"})} ***${s.groups?.function}***`,body:`${o({id:"aui.mdxEditor.hover.availableFunctionsAre"})} : \n${r.map((e=>`- ${e}`)).join("\n")}`,hint:k(s.groups?.function,r),formatMessage:o})}}));return a}},I={getDecorations:({textModel:e,cube:t,dataModel:o,classNames:n,formatMessage:r=(()=>"")})=>{if(!o&&!t)return[];const a=e.getValue().matchAll(/(?:FROM\s+)(?:([(])|\[([^\]]*)\]?|(\w*))/gi),s=t?[t.name]:o?(0,m.X)(o).map((({name:e})=>e)):[],i=[];for(const t of a){if("("===t[1])continue;const o=t[2]??t[3];t.index&&!s.includes(o)&&i.push(C({type:"error",classNames:n,textModel:e,offset:t.index,length:t[0]?.length,options:{hoverMessage:K({header:`${r({id:"aui.error.cubeNotFound"})} ***${o}***`,body:`${r({id:"aui.mdxEditor.hover.availableCubesAre"})} : \n${s.map((e=>`- ${e}`)).join("\n")}`,hint:k(o,s),formatMessage:r})}}))}return i}},R={getDecorations:({textModel:e,cube:t,dataModel:o,classNames:n,isCaseSensitive:r,formatMessage:a=(()=>"")})=>{if(!o&&!t)return[];const s=e.getValue().matchAll(/(\[(?<dimensionName>[^\]]*)\]?)(?<dotAfterDimension>\s*\.\s*)?((?:(\[(?<quotedHierarchy>[^\]]*)\]?)|(?<unquotedHierarchy>\w*)))?(?<dotAfterHierarchy>\s*\.\s*)?(?<memberPath>.*)?/gim),i=[];for(const l of s){if(!l.index)continue;const{dimensionName:s,dotAfterDimension:d,quotedHierarchy:u,unquotedHierarchy:g}=l.groups||{},p=e.getPositionAt(l.index);if((0,c.t)({dimensionName:s})||!r&&"measures"===s.toLowerCase()||["from ","member "].some((t=>e.getValueInRange({startLineNumber:p.lineNumber,endLineNumber:p.lineNumber,startColumn:0,endColumn:p.column}).toLowerCase().includes(t))))continue;const f=t?[t]:o?(0,m.X)(o):[],A=x(f),b=r?A.find((e=>e.name===s)):A.find((e=>e.name.toLowerCase()===s.toLowerCase()));if(void 0===b){const t=A.map((({name:e})=>e));i.push(C({type:"warning",classNames:n,textModel:e,offset:l.index,length:l[0]?.length,options:{hoverMessage:K({header:`${a({id:"aui.mdxEditor.hover.dimensionNotFound"})} ***${s}***`,body:`${a({id:"aui.mdxEditor.hover.availableDimensionsAre"})} : \n${t.map((e=>`- ${e}`)).join("\n")}`,hint:k(s,t),formatMessage:a})}}));continue}const h=(u||g)??"";if(d){const t=v(f,b.name);if(void 0===(r?t.find((e=>e.name===h)):t.find((e=>e.name.toLowerCase()===h.toLowerCase())))){const o=t.map((e=>e.name));i.push(C({type:"warning",classNames:n,textModel:e,offset:l.index,length:l[0]?.length,options:{hoverMessage:K({header:a({id:"aui.mdxEditor.hover.hierarchyWarning"},{dimensionName:s,hierarchyName:h}),body:`${a({id:"aui.mdxEditor.hover.availableHierarchiesAre"},{dimensionName:s,hierarchyName:h})} : \n${o.map((e=>`- ${e}`)).join("\n")}`,hint:k(h,o),formatMessage:a})}}));continue}}}return i}},L={getDecorations:({textModel:e,dataModel:t,classNames:o,formatMessage:n=(()=>"")})=>{if(!t)return[];const r=e.getValue().matchAll(new RegExp(`(${i.kpiKeywords.join("|")})[(][^]*?"(?<kpi>.*)"[^]*?[)]`,"gim")),a=(0,d.flatMap)((0,m.X)(t),(e=>Object.keys(e.kpis))),s=[];for(const t of r){const r=t.groups?.kpi??"";t.index&&!a.includes(r)&&s.push(C({type:"warning",classNames:o,textModel:e,offset:t.index,length:t[0]?.length,options:{hoverMessage:K({header:`${n({id:"aui.mdxEditor.hover.invalidKPI"})} ***${r}***`,body:`${n({id:"aui.mdxEditor.hover.availableKPIsAre"})} : \n${a.map((e=>`- ${e}`)).join("\n")}`,hint:k(r,a),formatMessage:n})}}))}return s}},S={getDecorations:({textModel:e,cube:t,dataModel:o,classNames:n,formatMessage:r=(()=>"")})=>{if(!o)return[];const a=e.getValue().matchAll(/(\[Measures]).(?:(\[(?<quotedMeasure>.*)\])|(?<unquotedMeasure>\w*))/gi),s=t?[t]:(0,m.X)(o),i=[...w(s).map((({name:e})=>e)),...p(e.getValue())],l=[];for(const t of a){const{groups:{unquotedMeasure:o,quotedMeasure:a}={unquotedMeasure:void 0,quotedMeasure:void 0}}=t||{},s=o??a??" ";if(t.index&&!i.includes(s)){const o=e.getPositionAt(t.index);if(["from","member"].some((t=>e.getValueInRange({startLineNumber:o.lineNumber,endLineNumber:o.lineNumber,startColumn:0,endColumn:o.column}).toLowerCase().includes(t))))continue;l.push(C({type:"warning",classNames:n,textModel:e,offset:t.index,length:t[0]?.length,options:{hoverMessage:K({header:`${r({id:"aui.mdxEditor.hover.invalidMeasure"})} **${s}**`,body:`${r({id:"aui.mdxEditor.hover.availableMeasuresAre"})} : \n${i.map((e=>`- ${e}`)).join("\n")}`,hint:k(s,i),formatMessage:r})}}))}}return l}},P=e=>`background-image:\n     linear-gradient(45deg, transparent 65%, ${e} 80%, transparent 90%),\n     linear-gradient(135deg, transparent 5%, ${e} 15%, transparent 25%),\n     linear-gradient(135deg, transparent 45%, ${e} 55%, transparent 65%),\n     linear-gradient(45deg, transparent 25%, ${e} 35%, transparent 50%);\n     background-repeat:repeat-x;\n     background-size: 8px 2px;\n     background-position:0 95%;`,O={line_error:P("red"),line_warning:P(N)},j={provideDocumentFormattingEdits:e=>{try{return[{range:e.getFullModelRange(),text:(0,i.stringify)((0,i.parse)(e.getValue()),{indent:!0})}]}catch{}}},V={id:"mdx",monarchLanguage:{defaultToken:"",tokenPostfix:".mdx",ignoreCase:!0,brackets:[{open:"{",close:"}",token:"delimiter.curly"},{open:"[",close:"]",token:"delimiter.square"},{close:"(",open:")",token:"delimiter.parenthesis"}],functionKeywords:i.functionKeywords,kpiKeywords:i.kpiKeywords,argumentKeywords:i.argumentKeywords,memberPropertyKeywords:i.memberPropertyKeywords,axisKeywords:i.axisKeywords,cellPropertyKeywords:i.cellPropertyKeywords,booleanOperatorKeywords:i.booleanOperatorKeywords,booleanKeywords:i.booleanKeywords,structuralKeywords:i.structuralKeywords,tokenizer:{root:[{include:"@comments"},{include:"@whiteSpace"},{include:"@numbers"},{include:"@strings"},{include:"@delimitedIdentifier"},[/[\w@]+/,{cases:{"@structuralKeywords":"keyword.structural","@booleanKeywords":"boolean","@booleanOperatorKeywords":"keyword.booleanOperator","@axisKeywords":"keyword.axis","@cellPropertyKeywords":"keyword.cellProperty","@functionKeywords":"keyword.function","@kpiKeywords":"keyword.kpi","@memberPropertyKeywords":"keyword.memberProperty","@argumentKeywords":"keyword.argument","@default":"identifier.regular"}}],{include:"@operators"}],comments:[[/(^|[^\\:])\/\/.*/,"comment"],[/(^|[^\\:])-{2}.*/,"comment"],[/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,"comment"]],whiteSpace:[[/\s+/,"white"]],numbers:[[/\d*\.\d+(E(\+|-)?\d+)?/,"number"],[/\d+/,"number"]],operators:[[/\+|\/|\*|\^|-/,"operator"],[/>=|<=|<>|=|>|</,"operator"],[/:|&/,"operator"]],delimitedIdentifier:[[/\[([^\]]{0,100})\]/,"identifier.delimited"]],strings:[[/'/,{token:"string",next:"@string"}],[/"/,{token:"string.double",next:"@stringDouble"}]],string:[[/[^']+/,"string"],[/''/,"string"],[/'/,{token:"string",next:"@pop"}]],stringDouble:[[/[^"]+/,"string.double"],[/""/,"string.double"],[/"/,{token:"string.double",next:"@pop"}]]}},configuration:{comments:{lineComment:"//",blockComment:["/*","*/"]},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],onEnterRules:[{beforeText:/.*\bSELECT\s*$/,action:{indentAction:1}},{beforeText:/.*\bFROM\s*$/,action:{indentAction:1}}]}},D=()=>{},q=(0,a.forwardRef)((({value:e,cube:t,dataModel:o,isCaseSensitive:r,classNames:m={},onChange:c=D,options:g={tabSize:2}},p)=>{const{formatMessage:f}=(0,s.useIntl)(),[A,b]=(0,a.useState)(),h=(0,a.useMemo)((()=>((e,t,o=(({id:e})=>`${e}`))=>({triggerCharacters:["[","."],provideCompletionItems:(n,r,a,s)=>{if(!s.isCancellationRequested)return{suggestions:M({position:r,textModel:n,cube:e,dataModel:t,formatMessage:o})}}}))(t,o,f)),[t,o,f]),y=(0,a.useMemo)((()=>(({value:e,mdxErrorDetails:t,cube:o,dataModel:n,classNames:r,formatMessage:a,isCaseSensitive:s})=>{if(!e)return[];const i=u.editor.createModel(e);return(0,d.flatMap)([$,I,S,R,L,E],(({getDecorations:e})=>e({textModel:i,mdxErrorDetails:t,cube:o,dataModel:n,classNames:r,formatMessage:a,isCaseSensitive:s})))})({value:e,dataModel:o,cube:t,mdxErrorDetails:A,classNames:m,formatMessage:f,isCaseSensitive:r})),[e,A,o,m,f,t,r]);return(0,a.useEffect)((()=>{try{e&&(0,i.parse)(e),b(void 0)}catch(e){if(!(e instanceof i.MdxError))throw e;b(e.details)}}),[e]),(0,n.Y)(l.default,{ref:p,value:e,onChange:c,language:V,options:g,documentFormattingEditProvider:j,completionItemProvider:h,deltaDecorations:y})})),F=(0,a.forwardRef)(((e,t)=>(0,n.Y)(r.ClassNames,{children:({css:o})=>(0,n.Y)(q,{...e,ref:t,classNames:{line_error:o(O.line_error),line_warning:o(O.line_warning)}})})))},68968:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAAAHUlEQVQYV2PYvXu3JAi7uLiAMaYAjAGTQBPYLQkAa/0Zef3qRswAAAAASUVORK5CYII="},3552:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAL0lEQVQoz2NgCD3x//9/BhBYBWdhgFVAiVW4JBFKGIa4AqD0//9D3pt4I4tAdAMAHTQ/j5Zom30AAAAASUVORK5CYII="},62974:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAz0lEQVRIx2NgYGBY/R8I/vx5eelX3n82IJ9FxGf6tksvf/8FiTMQAcAGQMDvSwu09abffY8QYSAScNk45G198eX//yev73/4///701eh//kZSARckrNBRvz//+8+6ZohwCzjGNjdgQxkAg7B9WADeBjIBqtJCbhRA0YNoIkBSNmaPEMoNmA0FkYNoFKhapJ6FGyAH3nauaSmPfwI0v/3OukVi0CIZ+F25KrtYcx/CTIy0e+rC7R1Z4KMICVTQQ14feVXIbR695u14+Ir4gwAAD49E54wc1kWAAAAAElFTkSuQmCC"}}]);