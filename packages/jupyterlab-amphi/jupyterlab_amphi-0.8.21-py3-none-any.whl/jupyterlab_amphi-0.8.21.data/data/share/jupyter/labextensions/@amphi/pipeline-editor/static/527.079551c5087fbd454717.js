"use strict";(self.webpackChunk_amphi_pipeline_editor=self.webpackChunk_amphi_pipeline_editor||[]).push([[527],{2527:(e,n,t)=>{t.r(n),t.d(n,{IPipelineTracker:()=>ee,default:()=>ne});var o=t(8379),a=t(700),i=t(4863),r=t(3476),s=t(2153),c=t(1327),l=t(3105),d=t(8536),p=t(7262),m=t(5826),u=t(3345),h=t.n(u);class g{static executeCommand(e,n){e.execute(n,{}).catch((e=>{console.error(`An error occurred during the execution of ${n}.\n${e}`)}))}static showErrorNotification(e,n){e.error(n,{actions:[{label:"Try to reload the application and run again.",callback:()=>location.reload()}],autoClose:6e3})}static checkSessionAndKernel(e,n){return n.context.sessionContext&&n.context.sessionContext.session?!n.context.sessionContext.hasNoKernel||(g.showErrorNotification(e,"The pipeline cannot be run because no processing engine can be found."),!1):(g.showErrorNotification(e,"The pipeline cannot be run because the local Python engine cannot be found."),!1)}static async executeKernelCode(e,n){const t=e.kernel.requestExecute({code:n});return t.onIOPub=e=>{if("stream"===e.header.msg_type);else if("error"===e.header.msg_type){const n=e.content;console.error(`Received error: ${n.ename}: ${n.evalue}`)}},t.done}static async executeKernelCodeWithNotifications(e,n,t,o={}){const a=performance.now(),i=new Promise(((e,o)=>{const i=n.kernel.requestExecute({code:t});i.onReply=n=>{const t=((performance.now()-a)/1e3).toFixed(1);"ok"===n.content.status?e({delayInSeconds:t}):o(new Error(`Execution failed: ${n.content.status}`))},i.onDone=()=>{const n=((performance.now()-a)/1e3).toFixed(1);e({delayInSeconds:n})}}));return e.promise(i,o),i}static extractDependencies(e){const n=e.split(/\r?\n/)[2];return n.startsWith("# Additional dependencies: ")?n.split(": ")[1].split(",").map((e=>e.trim())):[]}static async executeMultipleKernelCodesWithNotifications(e,n,t,o={}){console.log("Starting execution of multiple kernel codes.");const a=new p.PromiseDelegate,i=performance.now();console.log("Notification promise setup initiated."),e.promise(a.promise,o);try{for(const e of t){const t=n.kernel.requestExecute({code:e});await new Promise(((e,n)=>{t.onReply=e=>{"ok"!==e.content.status&&n(new Error("Kernel execution error"))},t.onIOPub=e=>{if("error"===e.header.msg_type){const t=e.content;console.error(`Received error: ${t.ename}: ${t.evalue}`),n(new Error(`Received error: ${t.ename}: ${t.evalue}`))}},t.onDone=()=>{console.log("Kernel execution done for this code."),e()}}))}const e=((performance.now()-i)/1e3).toFixed(1);console.log(`Execution finished successfully in ${e} seconds.`),a.resolve({delayInSeconds:e})}catch(e){const n=((performance.now()-i)/1e3).toFixed(1);console.error(`Execution failed after ${n} seconds.`,e),a.reject({delayInSeconds:n,error:e})}return console.log("Returning final delegate promise."),a.promise}}var v=t(7088),w=t(5256),f=t(2819),x=t(470);const y='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   width="16"\n   height="16"\n   fill="none"\n   viewBox="0 0 16 16"\n   version="1.1"\n   id="svg1"\n   sodipodi:docname="pipeline-brand-16.svg"\n   inkscape:version="1.3 (0e150ed, 2023-07-21)"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:svg="http://www.w3.org/2000/svg">\n  <defs\n     id="defs1" />\n  <sodipodi:namedview\n     id="namedview1"\n     pagecolor="#505050"\n     bordercolor="#eeeeee"\n     borderopacity="1"\n     inkscape:showpageshadow="0"\n     inkscape:pageopacity="0"\n     inkscape:pagecheckerboard="0"\n     inkscape:deskcolor="#505050"\n     inkscape:zoom="14.75"\n     inkscape:cx="8"\n     inkscape:cy="7.9661017"\n     inkscape:window-width="1512"\n     inkscape:window-height="874"\n     inkscape:window-x="0"\n     inkscape:window-y="32"\n     inkscape:window-maximized="1"\n     inkscape:current-layer="svg1" />\n  <path\n     fill="currentColor"\n     fill-rule="evenodd"\n     d="M2.75 2.5A1.75 1.75 0 001 4.25v1C1 6.216 1.784 7 2.75 7h1a1.75 1.75 0 001.732-1.5H6.5a.75.75 0 01.75.75v3.5A2.25 2.25 0 009.5 12h1.018c.121.848.85 1.5 1.732 1.5h1A1.75 1.75 0 0015 11.75v-1A1.75 1.75 0 0013.25 9h-1a1.75 1.75 0 00-1.732 1.5H9.5a.75.75 0 01-.75-.75v-3.5A2.25 2.25 0 006.5 4H5.482A1.75 1.75 0 003.75 2.5h-1zM2.5 4.25A.25.25 0 012.75 4h1a.25.25 0 01.25.25v1a.25.25 0 01-.25.25h-1a.25.25 0 01-.25-.25v-1zm9.75 6.25a.25.25 0 00-.25.25v1c0 .138.112.25.25.25h1a.25.25 0 00.25-.25v-1a.25.25 0 00-.25-.25h-1z"\n     clip-rule="evenodd"\n     id="path1"\n     style="fill:#5a8f7b;fill-opacity:1" />\n</svg>\n',b=(new x.LabIcon({name:"amphi:file-text-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><g fill="currentColor"><path d="M7.75 12a.75.75 0 000 1.5h8a.75.75 0 000-1.5h-8zM7 16.75a.75.75 0 01.75-.75h6a.75.75 0 010 1.5h-6a.75.75 0 01-.75-.75zM7.75 8a.75.75 0 000 1.5h2a.75.75 0 000-1.5h-2z"/><path fill-rule="evenodd" d="M3 3.75A2.75 2.75 0 015.75 1h7.586c.464 0 .909.184 1.237.513l5.914 5.914c.329.328.513.773.513 1.237V20.25A2.75 2.75 0 0118.25 23H5.75A2.75 2.75 0 013 20.25V3.75zM5.75 2.5c-.69 0-1.25.56-1.25 1.25v16.5c0 .69.56 1.25 1.25 1.25h12.5c.69 0 1.25-.56 1.25-1.25V9h-5.75a.75.75 0 01-.75-.75V2.5H5.75zm8.75 1.06l3.94 3.94H14.5V3.56z" clip-rule="evenodd"/></g></svg>'}),new x.LabIcon({name:"amphi:file-plus-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><g fill="currentColor"><path d="M11.75 10.75a.75.75 0 01.75.75V14H15a.75.75 0 010 1.5h-2.5V18a.75.75 0 01-1.5 0v-2.5H8.5a.75.75 0 010-1.5H11v-2.5a.75.75 0 01.75-.75z"/><path fill-rule="evenodd" d="M5.75 1A2.75 2.75 0 003 3.75v16.5A2.75 2.75 0 005.75 23h12.5A2.75 2.75 0 0021 20.25V8.664c0-.464-.184-.909-.513-1.237l-5.914-5.914A1.75 1.75 0 0013.336 1H5.75zM4.5 3.75c0-.69.56-1.25 1.25-1.25H13v5.75c0 .414.336.75.75.75h5.75v11.25c0 .69-.56 1.25-1.25 1.25H5.75c-.69 0-1.25-.56-1.25-1.25V3.75zM18.44 7.5L14.5 3.56V7.5h3.94z" clip-rule="evenodd"/></g></svg>'}),new x.LabIcon({name:"amphi:monitor-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M1 4.75A2.75 2.75 0 013.75 2h16.5A2.75 2.75 0 0123 4.75v10.5A2.75 2.75 0 0120.25 18H12.5v2.5H16a.75.75 0 010 1.5H8a.75.75 0 010-1.5h3V18H3.75A2.75 2.75 0 011 15.25V4.75zM20.25 16.5c.69 0 1.25-.56 1.25-1.25V4.75c0-.69-.56-1.25-1.25-1.25H3.75c-.69 0-1.25.56-1.25 1.25v10.5c0 .69.56 1.25 1.25 1.25h16.5z" clip-rule="evenodd"/></svg>'}),new x.LabIcon({name:"amphi:api-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M2 5a3 3 0 115.585 1.524l1.79 1.79.68-.68a2.75 2.75 0 013.89 0l.68.68 1.79-1.79a3 3 0 111.06 1.06l-1.79 1.791.681.68a2.75 2.75 0 010 3.89l-.68.68 1.79 1.79a3 3 0 11-1.06 1.06l-1.791-1.79-.68.681a2.75 2.75 0 01-3.89 0l-.68-.68-1.79 1.79a3 3 0 11-1.06-1.06l1.79-1.791-.681-.68a2.75 2.75 0 010-3.89l.68-.68-1.79-1.79A3 3 0 012 5zm3-1.5a1.5 1.5 0 100 3 1.5 1.5 0 000-3zm0 14a1.5 1.5 0 100 3 1.5 1.5 0 000-3zM17.5 19a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM19 3.5a1.5 1.5 0 100 3 1.5 1.5 0 000-3zm-7.884 5.195a1.25 1.25 0 011.768 0l2.421 2.421a1.25 1.25 0 010 1.768l-2.421 2.421a1.25 1.25 0 01-1.768 0l-2.421-2.421a1.25 1.25 0 010-1.768l2.421-2.421z" clip-rule="evenodd"/></svg>'}),new x.LabIcon({name:"amphi:pipeline-icon",svgstr:y})),k=new x.LabIcon({name:"amphi:component-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M7 9.25A2.75 2.75 0 019.75 6.5h5a2.75 2.75 0 012.75 2.75V11h4.75a.75.75 0 010 1.5H17.5v1.75A2.75 2.75 0 0114.75 17h-5A2.75 2.75 0 017 14.25V12.5H2.25a.75.75 0 010-1.5H7V9.25zm9 0C16 8.56 15.44 8 14.75 8h-5c-.69 0-1.25.56-1.25 1.25v5c0 .69.56 1.25 1.25 1.25h5c.69 0 1.25-.56 1.25-1.25v-5z" clip-rule="evenodd"/></svg>'}),C=new x.LabIcon({name:"amphi:pipelinenegative-icon",svgstr:y}),E=new x.LabIcon({name:"amphi:pipelineCategory-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   width="24"\n   height="24"\n   fill="none"\n   viewBox="0 0 24 24"\n   version="1.1"\n   id="svg1"\n   sodipodi:docname="pipeline-brand-24.svg"\n   inkscape:version="1.3 (0e150ed, 2023-07-21)"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:svg="http://www.w3.org/2000/svg">\n  <defs\n     id="defs1" />\n  <sodipodi:namedview\n     id="namedview1"\n     pagecolor="#505050"\n     bordercolor="#eeeeee"\n     borderopacity="1"\n     inkscape:showpageshadow="0"\n     inkscape:pageopacity="0"\n     inkscape:pagecheckerboard="0"\n     inkscape:deskcolor="#505050"\n     inkscape:zoom="9.8333333"\n     inkscape:cx="12"\n     inkscape:cy="11.949153"\n     inkscape:window-width="1512"\n     inkscape:window-height="874"\n     inkscape:window-x="0"\n     inkscape:window-y="32"\n     inkscape:window-maximized="1"\n     inkscape:current-layer="svg1" />\n  <path\n     fill="currentColor"\n     fill-rule="evenodd"\n     d="M4.75 4.5A2.25 2.25 0 002.5 6.75v1A2.25 2.25 0 004.75 10h1a2.25 2.25 0 002.236-2H9.82c.967 0 1.75.784 1.75 1.75v4.5a3.25 3.25 0 003.25 3.25h1.195a2.25 2.25 0 002.236 2h1a2.25 2.25 0 002.25-2.25v-1A2.25 2.25 0 0019.25 14h-1a2.25 2.25 0 00-2.236 2h-1.195a1.75 1.75 0 01-1.75-1.75v-4.5A3.25 3.25 0 009.82 6.5H7.986a2.25 2.25 0 00-2.236-2h-1zM4 6.75A.75.75 0 014.75 6h1a.75.75 0 01.75.75v1a.75.75 0 01-.75.75h-1A.75.75 0 014 7.75v-1zm14.25 8.75a.75.75 0 00-.75.75v1c0 .414.336.75.75.75h1a.75.75 0 00.75-.75v-1a.75.75 0 00-.75-.75h-1z"\n     clip-rule="evenodd"\n     id="path1"\n     style="fill:#5a8f7b;fill-opacity:1" />\n</svg>\n'}),S=(new x.LabIcon({name:"amphi:align-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n\x3c!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --\x3e\n\n<svg\n   width="800px"\n   height="800px"\n   viewBox="0 0 24 24"\n   fill="none"\n   version="1.1"\n   id="svg1"\n   sodipodi:docname="align.svg"\n   inkscape:version="1.3 (0e150ed, 2023-07-21)"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:svg="http://www.w3.org/2000/svg">\n  <defs\n     id="defs1" />\n  <sodipodi:namedview\n     id="namedview1"\n     pagecolor="#505050"\n     bordercolor="#eeeeee"\n     borderopacity="1"\n     inkscape:showpageshadow="0"\n     inkscape:pageopacity="0"\n     inkscape:pagecheckerboard="0"\n     inkscape:deskcolor="#505050"\n     inkscape:zoom="0.295"\n     inkscape:cx="400"\n     inkscape:cy="401.69492"\n     inkscape:window-width="1504"\n     inkscape:window-height="780"\n     inkscape:window-x="2301"\n     inkscape:window-y="549"\n     inkscape:window-maximized="0"\n     inkscape:current-layer="svg1" />\n  <path\n     d="M 22.81921,12 H 1.3615819 M 16.262712,6.0395476 v 0 c -0.329136,0 -0.596045,0.2668614 -0.596045,0.5960451 V 17.364407 c 0,0.329137 0.266909,0.596046 0.596045,0.596046 v 0 c 0.329137,0 0.596046,-0.266909 0.596046,-0.596046 V 6.6355928 c 0,-0.3291838 -0.266909,-0.5960452 -0.596046,-0.5960452 z M 7.918079,2.4632765 v 0 c -0.3291838,0 -0.5960452,0.2668613 -0.5960452,0.5960452 V 20.940679 c 0,0.329136 0.2668614,0.596045 0.5960452,0.596045 v 0 c 0.3291839,0 0.5960452,-0.266909 0.5960452,-0.596045 V 3.0593217 c 0,-0.3291839 -0.2668613,-0.5960452 -0.5960452,-0.5960452 z"\n     stroke="#000000"\n     stroke-width="2.38418"\n     stroke-linecap="round"\n     stroke-linejoin="round"\n     id="path1" />\n</svg>\n'}),new x.LabIcon({name:"amphi:export-svg-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n\x3c!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --\x3e\n\n<svg\n   fill="#000000"\n   width="800px"\n   height="800px"\n   viewBox="0 0 24 24"\n   id="export-2"\n   data-name="Flat Line"\n   class="icon flat-line"\n   version="1.1"\n   sodipodi:docname="export-svg.svg"\n   inkscape:version="1.3 (0e150ed, 2023-07-21)"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:svg="http://www.w3.org/2000/svg">\n  <defs\n     id="defs1" />\n  <sodipodi:namedview\n     id="namedview1"\n     pagecolor="#505050"\n     bordercolor="#eeeeee"\n     borderopacity="1"\n     inkscape:showpageshadow="0"\n     inkscape:pageopacity="0"\n     inkscape:pagecheckerboard="0"\n     inkscape:deskcolor="#505050"\n     inkscape:zoom="0.295"\n     inkscape:cx="400"\n     inkscape:cy="400"\n     inkscape:window-width="2560"\n     inkscape:window-height="1343"\n     inkscape:window-x="1512"\n     inkscape:window-y="149"\n     inkscape:window-maximized="1"\n     inkscape:current-layer="export-2" />\n  <g\n     id="g1"\n     transform="matrix(1.1983051,0,0,1.1983051,-2.3288136,-2.3288136)">\n    <polyline\n       id="primary"\n       points="15 3 21 3 21 9"\n       style="fill:none;stroke:#000000;stroke-width:2;stroke-linecap:round;stroke-linejoin:round" />\n    <line\n       id="primary-2"\n       data-name="primary"\n       x1="11"\n       y1="13"\n       x2="21"\n       y2="3"\n       style="fill:none;stroke:#000000;stroke-width:2;stroke-linecap:round;stroke-linejoin:round" />\n    <path\n       id="primary-3"\n       data-name="primary"\n       d="m 21,13 v 7 a 1,1 0 0 1 -1,1 H 4 A 1,1 0 0 1 3,20 V 4 A 1,1 0 0 1 4,3 h 7"\n       style="fill:none;stroke:#000000;stroke-width:2;stroke-linecap:round;stroke-linejoin:round" />\n  </g>\n</svg>\n'})),I=new x.LabIcon({name:"amphi:grid-alt-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><g fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"><path d="M1 2.25C1 1.56 1.56 1 2.25 1h3.5C6.44 1 7 1.56 7 2.25v3.5C7 6.44 6.44 7 5.75 7h-3.5C1.56 7 1 6.44 1 5.75v-3.5zm1.5.25v3h3v-3h-3zM9 2.25C9 1.56 9.56 1 10.25 1h3.5c.69 0 1.25.56 1.25 1.25v3.5C15 6.44 14.44 7 13.75 7h-3.5C9.56 7 9 6.44 9 5.75v-3.5zm1.5.25v3h3v-3h-3zM18.25 1C17.56 1 17 1.56 17 2.25v3.5c0 .69.56 1.25 1.25 1.25h3.5C22.44 7 23 6.44 23 5.75v-3.5C23 1.56 22.44 1 21.75 1h-3.5zm.25 4.5v-3h3v3h-3zM1 10.25C1 9.56 1.56 9 2.25 9h3.5C6.44 9 7 9.56 7 10.25v3.5C7 14.44 6.44 15 5.75 15h-3.5C1.56 15 1 14.44 1 13.75v-3.5zm1.5.25v3h3v-3h-3zM10.25 9C9.56 9 9 9.56 9 10.25v3.5c0 .69.56 1.25 1.25 1.25h3.5c.69 0 1.25-.56 1.25-1.25v-3.5C15 9.56 14.44 9 13.75 9h-3.5zm.25 4.5v-3h3v3h-3zM17 10.25c0-.69.56-1.25 1.25-1.25h3.5c.69 0 1.25.56 1.25 1.25v3.5c0 .69-.56 1.25-1.25 1.25h-3.5c-.69 0-1.25-.56-1.25-1.25v-3.5zm1.5.25v3h3v-3h-3zM2.25 17C1.56 17 1 17.56 1 18.25v3.5c0 .69.56 1.25 1.25 1.25h3.5C6.44 23 7 22.44 7 21.75v-3.5C7 17.56 6.44 17 5.75 17h-3.5zm.25 4.5v-3h3v3h-3zM9 18.25c0-.69.56-1.25 1.25-1.25h3.5c.69 0 1.25.56 1.25 1.25v3.5c0 .69-.56 1.25-1.25 1.25h-3.5C9.56 23 9 22.44 9 21.75v-3.5zm1.5.25v3h3v-3h-3zM18.25 17c-.69 0-1.25.56-1.25 1.25v3.5c0 .69.56 1.25 1.25 1.25h3.5c.69 0 1.25-.56 1.25-1.25v-3.5c0-.69-.56-1.25-1.25-1.25h-3.5zm.25 4.5v-3h3v3h-3z"/></g></svg>'});async function D(e,n,t,o){var a;try{await t.execute("pipeline-editor:run-pipeline-until",{nodeId:e,context:n});const i=f.PipelineService.getNodeById(n.model.toString(),e);console.log("nodeJson %o",i);const r=i.data.nameId;if(!r)return void console.error("Variable name not found for the selected component.");const s=null===(a=n.sessionContext.session)||void 0===a?void 0:a.kernel;if(!s)return void console.error("Kernel is not available.");const c=await async function(e,n,t=1e4){const o=`_amphi_metadatapanel_getmatrixcontent(${e}, ${t})`;return new Promise(((e,t)=>{const a=n.requestExecute({code:o,stop_on_error:!1,store_history:!1});a.onIOPub=n=>{switch(n.header.msg_type){case"execute_result":let o=n.content.data["text/plain"];o=o.replace(/^'|'$/g,""),o=o.replace(/\\"/g,'"'),o=o.replace(/\\'/g,"\\\\'");const a=JSON.parse(o),i=new v.JSONModel(a);e(i);break;case"error":t("Kernel error on 'matrixQuery' call!")}},a.onReply=e=>{},a.onDone=()=>{}}))}(r,s),l=new A(c),d="amphi-logConsole";let p=null;for(const e of o.shell.widgets("main"))if(e.id===d){p=e;break}p&&p.isAttached?l.isAttached||o.shell.add(l,"main",{ref:p.id,mode:"tab-after"}):l.isAttached||o.shell.add(l,"main",{mode:"split-bottom"}),o.shell.activateById(l.id)}catch(e){console.error("Error viewing data:",e)}}class A extends w.StackedPanel{constructor(e){super(),this.id="datagrid-viewer",this.title.label="Data Browser",this.title.closable=!0,this.title.icon=I;const n=new v.DataGrid({minimumSizes:{rowHeight:30,columnWidth:100,rowHeaderWidth:100,columnHeaderHeight:30},style:{...v.DataGrid.defaultStyle,backgroundColor:"#fff",voidColor:"#fff",headerGridLineColor:"#F0F0F0",headerHorizontalGridLineColor:"#F0F0F0",headerVerticalGridLineColor:"#F0F0F0",headerBackgroundColor:"#FAFAFA",headerSelectionBorderColor:"#44776D",selectionBorderColor:"#44776D",selectionFillColor:"rgba(68, 119, 109, 0.2)",cursorBorderColor:"#44776D",gridLineColor:"#F0F0F0"}});n.dataModel=e,n.keyHandler=new v.BasicKeyHandler,n.mouseHandler=new v.BasicMouseHandler,n.selectionModel=new v.BasicSelectionModel({dataModel:e}),this.addWidget(n)}}var N=t(5505),F=t(192),P=t(5593),z=t.n(P);const B={maxHistorySize:100,enableShortcuts:!0};var M=t(7832);const R=function({pipelineName:e,pipelineId:n}){const{getNodes:t}=(0,P.useReactFlow)();return h().createElement(P.ControlButton,{onClick:()=>{(0,P.getNodesBounds)(t());const o=document.querySelector(`.reactflow-wrapper[data-id="${n}"]`);if(o instanceof HTMLElement){const{width:n,height:t}=o.getBoundingClientRect();(0,M.toSvg)(o,{backgroundColor:"#ffffff",width:n,height:t}).then((n=>function(e,n){const t=n.replace(/[^a-z0-9]/gi,"_").toLowerCase(),o=document.createElement("a");o.setAttribute("download",`${t}.svg`),o.setAttribute("href",e),o.click()}(n,e)))}}},h().createElement(S.react,null))};var _=t(4810),L=t(4393);const{DirectoryTree:T}=_.Tree,{Search:$}=_.Input,H=({componentService:e})=>{const[n,t]=(0,u.useState)(""),[o,a]=(0,u.useState)([]),[i,r]=(0,u.useState)(!0),[s,c]=(0,u.useState)([]);(0,u.useEffect)((()=>{const n=e.getComponents();c(n)}),[e]);const l=(e,n,t)=>{e.dataTransfer.setData("application/reactflow",n),e.dataTransfer.setData("additionalData",t),e.dataTransfer.effectAllowed="move"},d=(0,u.useMemo)((()=>{const e={};return s.forEach((n=>{let[t,o]=n._category.split(".");e[t]||(e[t]={}),o?(e[t][o]||(e[t][o]=[]),e[t][o].push(n)):(e[t]._||(e[t]._=[]),e[t]._.push(n))})),e}),[s]),p=(e,n)=>e.map((e=>{const t={...e},o="object"==typeof t.title.props.children?t.title.props.children.props.children:t.title.props.children;return t.children&&(t.children=p(t.children,n)),o.toLowerCase().includes(n.toLowerCase())||t.children&&t.children.length>0?t:null})).filter((e=>null!==e)),m=(0,u.useMemo)((()=>Object.keys(d).map(((e,n)=>{const t=Object.keys(d[e]);let o=[];return t.forEach(((t,a)=>{"_"===t?o.push(...d[e][t].map(((e,t)=>({title:h().createElement(_.Tooltip,{placement:"left",title:e._description?e._description:"",arrow:!0,mouseEnterDelay:1,mouseLeaveDelay:0,align:{offset:[-30,0]},overlayInnerStyle:{fontSize:"12px"}},h().createElement("span",{draggable:!0,className:"palette-component",onDragStart:n=>l(n,e._id,e._default?JSON.stringify(e._default):"{}"),key:`category-${n}-item-${t}`},e._name)),key:`category-${n}-item-${t}`,isLeaf:!0,icon:h().createElement("span",{className:"anticon"},h().createElement(e._icon.react,{height:"14px",width:"14px;"}))})))):o.push({title:h().createElement("span",{className:"palette-component-category"},t.charAt(0).toUpperCase()+t.slice(1)),key:`category-${n}-sub-${a}`,children:d[e][t].map(((e,t)=>({title:h().createElement(_.Tooltip,{placement:"left",title:e._description?e._description:"",arrow:!0,mouseEnterDelay:1,mouseLeaveDelay:0,align:{offset:[-30,0]},overlayInnerStyle:{fontSize:"12px"}},h().createElement("span",{draggable:!0,className:"palette-component",onDragStart:n=>l(n,e._id,e._default?JSON.stringify(e._default):"{}"),key:`category-${n}-sub-${a}-item-${t}`},e._name)),key:`category-${n}-sub-${a}-item-${t}`,isLeaf:!0,icon:h().createElement("span",{className:"anticon"},h().createElement(e._icon.react,{height:"14px",width:"14px;"}))})))})})),{title:h().createElement("span",{className:"palette-component-category"},e.charAt(0).toUpperCase()+e.slice(1)),key:`category-${n}`,children:o,style:{backgroundColor:"#F1F4F7",padding:"0px 0px 0px 0px",marginBottom:"Opx"}}}))),[d]),g=(0,u.useMemo)((()=>n&&n.trim()?p(m,n):m),[n,m]);return(0,u.useEffect)((()=>{const e=n=>n.reduce(((n,t)=>(n.push(t.key),t.children&&n.push(...e(t.children)),n)),[]),t=n?e(g):Object.keys(d).map(((e,n)=>`category-${n}`));a(t)}),[n,g,d]),h().createElement("aside",{className:"sidebar",title:"Components"},h().createElement(_.Space,{direction:"vertical",style:{marginTop:"10px",marginLeft:"10px",width:"90%",textAlign:"center"}},h().createElement(_.Input,{placeholder:"Search components",onChange:e=>{const{value:n}=e.target;t(n),r(!0)},style:{marginBottom:8},suffix:h().createElement(L.A,{style:{color:"rgba(0,0,0,.25)"}})})),h().createElement(T,{selectable:!1,multiple:!0,blockNode:!0,autoExpandParent:i,expandedKeys:o,onExpand:e=>{a(e),r(!1)},treeData:g}))};var O=t(7628),V=t.n(O);function j({id:e,sourceX:n,sourceY:t,targetX:o,targetY:a,sourcePosition:i,targetPosition:r,style:s={},markerEnd:c}){const{setEdges:l}=(0,P.useReactFlow)(),[d,p,m]=(0,P.getBezierPath)({sourceX:n,sourceY:t,sourcePosition:i,targetX:o,targetY:a,targetPosition:r});return h().createElement(h().Fragment,null,h().createElement(P.BaseEdge,{path:d,markerEnd:c,style:s}),h().createElement(P.EdgeLabelRenderer,null,h().createElement("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${p}px,${m}px)`,fontSize:12,pointerEvents:"all"},className:"nodrag nopan"},h().createElement("button",{className:"edgebutton",onClick:()=>{l((n=>n.filter((n=>n.id!==e))))}},"×"))))}t(7576);const W=({children:e,...n})=>{const{getRootProps:t}=(e=>{const n=(0,u.useRef)(null),t=(0,u.useCallback)((n=>{var t,o,a,i;switch(n.preventDefault(),n.stopPropagation(),n.type){case"lm-dragenter":null===(t=e.onDragEnter)||void 0===t||t.call(e,n);break;case"lm-dragleave":null===(o=e.onDragLeave)||void 0===o||o.call(e,n);break;case"lm-dragover":n.dropAction=n.proposedAction,null===(a=e.onDragOver)||void 0===a||a.call(e,n);break;case"lm-drop":null===(i=e.onDrop)||void 0===i||i.call(e,n)}}),[e]);return(0,u.useEffect)((()=>{const e=n.current;return null==e||e.addEventListener("lm-dragenter",t),null==e||e.addEventListener("lm-dragleave",t),null==e||e.addEventListener("lm-dragover",t),null==e||e.addEventListener("lm-drop",t),()=>{null==e||e.removeEventListener("lm-dragenter",t),null==e||e.removeEventListener("lm-dragleave",t),null==e||e.removeEventListener("lm-dragover",t),null==e||e.removeEventListener("lm-drop",t)}}),[t]),{getRootProps:()=>({ref:n})}})(n);return h().createElement("div",{style:{height:"100%"},...t()},e)};var K=t(6271);t(502);const U=({code:e})=>h().createElement(K.Ay,{width:"100%%",height:"100%",mode:"python",theme:"xcode",name:"Code Export",fontSize:14,lineHeight:19,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,value:e,setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!0,showLineNumbers:!0,tabSize:2}});class G extends a.ReactWidget{constructor(e){super(),this.app=e.app,this.browserFactory=e.browserFactory,this.defaultFileBrowser=e.defaultFileBrowser,this.shell=e.shell,this.toolbarRegistry=e.toolbarRegistry,this.commands=e.commands,this.rendermimeRegistry=e.rendermimeRegistry,this.context=e.context,this.settings=e.settings,this.componentService=e.componentService;let n=null===this.context.model.toJSON();this.context.model.contentChanged.connect((()=>{n&&(n=!1,this.update())}))}render(){var e;return null===this.context.model.toJSON()?h().createElement("div",{className:"amphi-loader"}):h().createElement(J,{app:this.app,context:this.context,browserFactory:this.browserFactory,defaultFileBrowser:this.defaultFileBrowser,shell:this.shell,toolbarRegistry:this.toolbarRegistry,commands:this.commands,rendermimeRegistry:this.rendermimeRegistry,widgetId:null===(e=this.parent)||void 0===e?void 0:e.id,settings:this.settings,componentService:this.componentService})}}const J=({app:e,context:n,browserFactory:t,defaultFileBrowser:o,shell:i,toolbarRegistry:r,commands:s,rendermimeRegistry:c,settings:l,widgetId:d,componentService:p})=>{const m=o.model.manager,g={"custom-edge":j},v={...p.getComponents().reduce(((e,t)=>{const o=t._id,a=e=>h().createElement(t.UIComponent,{context:n,componentService:p,manager:m,commands:s,rendermimeRegistry:c,settings:l,...e});return e[o]=e=>h().createElement(a,{context:n,componentService:p,manager:m,commands:s,...e}),e}),{})},w=()=>"node_"+ +new Date;let x=l.get("defaultEngineBackend").composite;return console.log(`Settings extension in PipelineEditor: defaultEngineBackend is set to '${x}'`),h().createElement("div",{className:"canvas",id:"pipeline-panel"},h().createElement(_.ConfigProvider,{theme:{token:{colorPrimary:"#5F9B97"}}},h().createElement(P.ReactFlowProvider,null,h().createElement((function(e){e.context.model;const n=(0,u.useRef)(null),[t,r]=(0,u.useState)(e.context.model.toJSON()),s=t.id,c=t.pipelines[0].flow.nodes.map((e=>({...e,data:{...e.data,lastUpdated:0,lastExecuted:0}}))),l=t.pipelines[0].flow.edges,m=t.pipelines[0].flow.viewport,[y,b,k]=(0,P.useNodesState)(c),[C,E,S]=(0,P.useEdgesState)(l),[I,D]=(0,u.useState)(null),{getViewport:A,setViewport:N}=(0,P.useReactFlow)(),M=(0,P.useStoreApi)(),{undo:_,redo:L,canUndo:T,canRedo:$,takeSnapshot:H}=(({maxHistorySize:e=B.maxHistorySize,enableShortcuts:n=B.enableShortcuts}=B)=>{const[t,o]=(0,u.useState)([]),[a,i]=(0,u.useState)([]),{setNodes:r,setEdges:s,getNodes:c,getEdges:l}=(0,P.useReactFlow)(),d=(0,u.useCallback)((()=>{o((n=>[...n.slice(n.length-e+1,n.length),{nodes:c(),edges:l()}])),i([])}),[c,l,e]),p=(0,u.useCallback)((()=>{const e=t[t.length-1];e&&(o((e=>e.slice(0,e.length-1))),i((e=>[...e,{nodes:c(),edges:l()}])),r(e.nodes),s(e.edges))}),[r,s,c,l,t]),m=(0,u.useCallback)((()=>{const e=a[a.length-1];e&&(i((e=>e.slice(0,e.length-1))),o((e=>[...e,{nodes:c(),edges:l()}])),r(e.nodes),s(e.edges))}),[r,s,c,l,a]);return(0,u.useEffect)((()=>{if(!n)return;const e=e=>{"z"===e.key&&(e.ctrlKey||e.metaKey)&&e.shiftKey?m():"z"===e.key&&(e.ctrlKey||e.metaKey)&&p()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[p,m,n]),{undo:p,redo:m,takeSnapshot:d,canUndo:!t.length,canRedo:!a.length}})(),O=(0,u.useCallback)((()=>{H()}),[H]),V=(0,u.useCallback)((()=>{H()}),[H]),j=(0,u.useCallback)((()=>{H()}),[H]),K=t;K.pipelines[0].flow.nodes=y,K.pipelines[0].flow.edges=C,K.pipelines[0].flow.viewport=A(),e.context.model.fromJSON(K);const U=(0,u.useCallback)((e=>{var n;H();const t=y.find((n=>n.id===e.source)),o=y.find((n=>n.id===e.target));if(t&&o){const e=null===(n=t.data)||void 0===n?void 0:n.backend;(null==e?void 0:e.engine)&&b((n=>n.map((n=>{var t,a,i,r;return n.id===o.id?{...n,data:{...n.data,backend:{...n.data.backend,engine:(null===(a=null===(t=n.data)||void 0===t?void 0:t.backend)||void 0===a?void 0:a.prefix)&&n.data.backend.prefix!==e.prefix?n.data.backend.engine:e.engine,prefix:(null===(r=null===(i=n.data)||void 0===i?void 0:i.backend)||void 0===r?void 0:r.prefix)&&n.data.backend.prefix!==e.prefix?n.data.backend.prefix:e.prefix}}}:n}))))}E((n=>(0,P.addEdge)({...e,type:"custom-edge"},n)))}),[y,H]),G=e=>{const n=y.find((n=>n.id===e));if(n)return p.getComponent(n.type)._type},J=(0,u.useCallback)((e=>{E(e.reduce(((e,n)=>{const t=(0,P.getIncomers)(n,y,C),o=(0,P.getOutgoers)(n,y,C),a=(0,P.getConnectedEdges)([n],C);return[...e.filter((e=>!a.includes(e))),...t.flatMap((({id:e})=>o.map((({id:n})=>({id:`${e}->${n}`,source:e,target:n,type:"custom-edge"})))))]}),C)),H()}),[y,C,H]);function q(e,n){const t=n.filter((n=>{var t;return n.type===e&&(null===(t=n.data)||void 0===t?void 0:t.nameId)})).map((n=>{const t=new RegExp(`^${e}(\\d+)$`),o=n.data.nameId.match(t);return o?parseInt(o[1],10):0})),o=t.length>0?Math.max(...t):0;return`${e}${o+1}`}const X=(0,u.useCallback)((n=>{var t;const r=o;if((null===(t=i.currentWidget)||void 0===t?void 0:t.id)===d&&I&&n){const{height:t,width:o,transform:[i,s,c]}=M.getState(),l=1/c,d={x:(n.x-i)*l,y:(n.y-s)*l};Array.from(r.selectedItems()).forEach((async n=>{const t=n.path,o=n.name.split(".").pop(),i=n.name.split("/").pop();if("amcpn"===o){const e=new F.ContentsManager;try{const n=(await e.get(t)).content,o=JSON.parse(n),{type:i,data:r}=o.component;if(i&&r){const e={id:w(),type:i,position:d,data:{nameId:q(i,y),...r,lastUpdated:Date.now()}};b((n=>n.concat(e)))}else(0,a.showDialog)({title:"Invalid Component",body:"The selected file does not contain valid component data.",buttons:[a.Dialog.okButton()]})}catch(e){(0,a.showDialog)({title:"Error Reading File",body:"There was an error reading the file.",buttons:[a.Dialog.okButton()]})}return}const{id:r,default:s}=f.PipelineService.getComponentIdForFileExtension(o,p,x),c=p.getComponent(r)._default;if(r){const n={id:w(),type:r,position:d,data:{...c,nameId:q(r,y),filePath:f.PipelineService.getRelativePath(e.context.sessionContext.path,t),lastUpdated:Date.now(),customTitle:i,...s||{}}};b((e=>e.concat(n)))}else(0,a.showDialog)({title:"Unsupported File(s)",body:"Only supported files can be added to a pipeline.",buttons:[a.Dialog.okButton()]})}))}}),[o,i,d,I,y]),Y=(0,u.useCallback)((e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"}),[]),Q=(0,u.useCallback)((e=>{H(),e.preventDefault();const t=n.current.getBoundingClientRect(),o=e.dataTransfer.getData("application/reactflow"),a=JSON.parse(e.dataTransfer.getData("additionalData")),i=w(),r=p.getComponent(o)._default;if(void 0===o||!o)return;const s={id:i,type:o,position:I.project({x:e.clientX-t.left,y:e.clientY-t.top}),data:{...r,nameId:q(o,y),...a,lastUpdated:Date.now()}};b((e=>e.concat(s)))}),[I,y]);return(0,u.useCallback)((n=>{const o={...t};o.pipelines[0].flow.viewport=n,e.context.model.fromJSON(o)}),[t,e]),h().createElement("div",{className:"reactflow-wrapper","data-id":s,ref:n},h().createElement(u.Profiler,{id:s,onRender:(e,n,t)=>{console.log({id:e,phase:n,actualDuration:t})}},h().createElement(W,{onDrop:async e=>{H(),X({x:e.offsetX,y:e.offsetY})}},h().createElement(z(),{id:s,nodes:y,edges:C,onNodesChange:k,onNodesDelete:J,onEdgesDelete:j,onEdgesChange:S,onConnect:U,onNodeDragStart:O,onSelectionDragStart:V,isValidConnection:e=>{const n=G(e.source),t=G(e.target);return"pandas_df_to_documents_processor"===n||n.startsWith("documents")?t.startsWith("documents"):n.startsWith("pandas_df")?t.startsWith("pandas_df"):!!n.startsWith("ibis_df")&&t.startsWith("ibis_df")},onDrop:Q,onDragOver:Y,onInit:D,edgeTypes:g,nodeTypes:v,snapToGrid:!0,snapGrid:[15,15],fitViewOptions:{minZoom:.5,maxZoom:1,padding:.4},defaultViewport:m,deleteKeyCode:["Delete","Backspace"],proOptions:{hideAttribution:!0}},h().createElement(P.Panel,{position:"top-right"}),h().createElement(P.Controls,null,h().createElement(R,{pipelineName:e.context.sessionContext.path,pipelineId:s})),h().createElement(P.Background,{color:"#aaa",gap:20})))))}),{context:n}),h().createElement(H,{componentService:p}))))};class q extends N.ABCWidgetFactory{constructor(e){super(e),this.app=e.app,this.browserFactory=e.browserFactory,this.defaultFileBrowser=e.defaultFileBrowser,this.shell=e.app.shell,this.toolbarRegistry=e.toolbarRegistry,this.commands=e.app.commands,this.settings=e.settings,this.componentService=e.componentService}createNewWidget(e){const n={app:this.app,shell:this.shell,toolbarRegistry:this.toolbarRegistry,commands:this.commands,browserFactory:this.browserFactory,defaultFileBrowser:this.defaultFileBrowser,context:e,settings:this.settings,componentService:this.componentService};let t=this.settings.get("enableExecution").composite;console.log(`Settings extension in PipelineEditor: enableExecution is set to '${t}'`),e.sessionContext.kernelPreference=t?{autoStartDefault:!0,name:"python",shutdownOnDispose:!1}:{shouldStart:!1,canStart:!1,shutdownOnDispose:!0};const o=new G(n),i=new N.DocumentWidget({content:o,context:e}),r=new a.ToolbarButton({label:"Save Pipeline",icon:x.saveIcon,onClick:()=>{this.commands.execute("docmanager:save")}});i.toolbar.addItem("save",r);const s=new a.ToolbarButton({label:"Export to Python code",iconLabel:"Export to Python code",icon:x.codeIcon,onClick:async()=>{!async function(e,n){const t=document.createElement("div");t.style.width="900px",t.style.height="1000px";const o=new w.Widget({node:t});V().render(h().createElement(U,{code:e}),t),"Open in new file"===(await(0,a.showDialog)({title:"Generated Python Code",body:o,buttons:[a.Dialog.okButton({label:"Close"}),a.Dialog.createButton({label:"Open in new file",className:"",accept:!0})]})).button.label&&await(async()=>{const t=await n.execute("docmanager:new-untitled",{path:"/",type:"file",ext:".py"});(await n.execute("docmanager:open",{path:t.path})).context.model.fromString(e)})()}(await f.CodeGenerator.generateCode(e.model.toString(),this.commands,this.componentService,!0),this.commands)}});i.toolbar.addItem("generateCode",s);const c=new a.ToolbarButton({label:"Run Pipeline",iconLabel:"Run Pipeline",icon:x.runIcon,onClick:async()=>{this.commands.execute("docmanager:save");const n=f.CodeGenerator.generateCode(e.model.toString(),this.commands,this.componentService,!0);this.commands.execute("pipeline-editor:run-pipeline",{code:n}).catch((e=>{console.error(`An error occurred during the execution of 'pipeline-editor:run-pipeline'.\n${e}`)}))},enabled:t});i.toolbar.addItem("runPipeline",c);const l=new a.ToolbarButton({label:"Console",iconLabel:"Console",icon:x.listIcon,onClick:async()=>{const e="pipeline-console:open";this.commands.execute(e,{}).catch((n=>{console.error(`An error occurred during the execution of ${e}.\n${n}`)}))},enabled:t});i.toolbar.addItem("openlogconsole",l);const d=a.Toolbar.createKernelNameItem(n.context.sessionContext),p=x.Toolbar.createSpacerItem();return i.toolbar.addItem("spacer",p),i.toolbar.addItem("kernelName",d),i.addClass("amphi-PipelineEditor"),i.title.icon=b,i}}var X;!function(e){e.create="pipeline-editor:create-new",e.restartPipelineKernel="pipeline-editor:restart-kernel",e.runPipeline="pipeline-editor:run-pipeline",e.runPipelineUntil="pipeline-editor:run-pipeline-until",e.runIncrementalPipelineUntil="pipeline-editor:run-incremental-pipeline-until"}(X||(X={}));const Y="Pipeline Editor",Q="amphi-pipeline",Z="@amphi/pipeline-editor:extension",ee=new p.Token("pipeline-editor-tracker"),ne=[{id:Z,autoStart:!0,requires:[a.ICommandPalette,l.IRenderMimeRegistry,s.ILauncher,c.IFileBrowserFactory,c.IDefaultFileBrowser,d.IStatusBar,o.ILayoutRestorer,i.IMainMenu,r.ISettingRegistry,a.IToolbarWidgetRegistry,a.ISessionContextDialogs,m.IDocumentManager,f.ComponentManager],provides:ee,activate:(e,n,t,o,i,r,s,c,l,d,p,m,u,v)=>{console.log("Amphi Pipeline Extension activation...");const{commands:w}=e,x=X.create,y=new a.WidgetTracker({namespace:"amphi-pipeline-editor"});let b,S,I;function A(e){b=e.get("enableExecution").composite,console.log(`Settings extension: enableExecution is set to '${b}'`),S=e.get("enableDebugMode").composite,console.log(`Settings extension: enableDebugMode is set to '${S}'`),I=e.get("defaultEngineBackend").composite,console.log(`Settings extension: defaultEngineBackend is set to '${I}'`)}return Promise.all([e.restored,d.load(Z)]).then((([,s])=>{A(s),s.changed.connect(A);const c=new q({app:e,name:Y,fileTypes:[Q],defaultFor:[Q],canStartKernel:!0,preferKernel:!0,shutdownOnClose:!0,toolbarRegistry:p,rendermime:t,browserFactory:i,defaultFileBrowser:r,settings:s,componentService:v});function l(n){const t=y.currentWidget;return!1!==n.activate&&t&&e.shell.activateById(t.id),null!=t?t:null}function d(){return null!==y.currentWidget&&y.currentWidget===e.shell.currentWidget}c.widgetCreated.connect(((e,n)=>{y.add(n),n.context.pathChanged.connect((()=>{y.save(n)}))})),e.docRegistry.addFileType({name:"amphi-pipeline",displayName:"pipeline",extensions:[".ampln"],icon:C,fileFormat:"text"},[Y,"JSON"]),e.docRegistry.addWidgetFactory(c),e.docRegistry.addFileType({name:"amphi-component",displayName:"component",extensions:[".amcpn"],icon:k,fileFormat:"text"},["JSON"]),w.addCommand(x,{label:e=>(e.isPalette||e.isContextMenu,"New Pipeline"),caption:"Create a new pipeline",icon:e=>e.isPalette?null:E,execute:async n=>w.execute("docmanager:new-untitled",{type:"file",path:r.model.path,ext:".ampln"}).then((async n=>{const t={doc_type:"Amphi Pipeline",version:"1",json_schema:"http://docs.amphi.ai/schemas/pipeline-v1-schema.json",id:"pipeline_"+ +new Date,pipelines:[{id:"primary",flow:{nodes:[],edges:[],viewport:{x:0,y:0,zoom:1}},app_data:{ui_data:{comments:[]},version:1,runtime_type:"LOCAL"},runtime_ref:"python"}]},o=await e.commands.execute("docmanager:open",{path:n.path,factory:Y});o.context.ready.then((()=>{o.context.model.fromJSON(t),e.commands.execute("docmanager:save",{path:n.path})}))}))}),w.addCommand(X.restartPipelineKernel,{label:"Restart Runtime…",execute:async e=>{const n=l({activate:!1,...e});if(n)try{await n.context.sessionContext.restartKernel()}catch(e){console.error("Failed to restart runtime: ",e)}},isEnabled:d}),w.addCommand(X.runPipeline,{label:"Run Pipeline",execute:async e=>{try{e.datapanel?g.executeCommand(w,"metadatapanel:open"):g.executeCommand(w,"pipeline-console:open");const n=l(e);if(!n)return;if(!g.checkSessionAndKernel(a.Notification,n))return;await n.context.sessionContext.ready;const t=e.code.toString(),o=g.extractDependencies(t);if(o.length>0&&""!==o[0]){const e=f.PipelineService.getInstallCommandsFromPackageNames(o).join("\n");s.get("enableDebugMode").composite&&console.log("Dependencies to be installed: %o",e),await g.executeKernelCode(n.context.sessionContext.session,e)}const i=`\nimport time\ntime.sleep(0.25)\n${e.code}\n`,r={pending:{message:"Running...",options:{autoClose:!1}},success:{message:e=>`Pipeline execution successful after ${e.delayInSeconds} seconds.`,options:{autoClose:3e3}},error:{message:()=>"Pipeline execution failed. Check error messages in the Log Console.",options:{actions:[{label:"Log Console",callback:()=>{g.executeCommand(w,"pipeline-console:open")}}],autoClose:5e3}}};await g.executeKernelCodeWithNotifications(a.Notification,n.context.sessionContext.session,i,r)}catch(e){throw console.error("Error in runPipeline command:",e),e}},isEnabled:d}),w.addCommand(X.runPipelineUntil,{label:"Run pipeline until ...",execute:async e=>{try{const n=l(e);if(!n)throw new Error("No current context available.");const t=e.nodeId.toString(),o=(e.context,f.CodeGenerator.generateCodeUntil(n.context.model.toString(),w,v,t,!1,!1).join("\n"));await w.execute("pipeline-editor:run-pipeline",{code:o}),console.log("Pipeline executed successfully")}catch(e){throw console.error(`An error occurred during pipeline execution: ${e}`),e}}}),w.addCommand(X.runIncrementalPipelineUntil,{label:"Run incremental pipeline until ...",execute:async e=>{const n=l(e);if(!n)return;const t=e.nodeId.toString(),o=(e.context,f.CodeGenerator.generateCodeUntil(n.context.model.toString(),w,v,t,!0,!1)),i={pending:{message:"Running incremental code...",options:{autoClose:!1}},success:{message:"Code block executed successfully.",options:{autoClose:3e3}},error:{message:()=>"Execution failed. Stopping pipeline.",options:{actions:[{label:"Log Console",callback:()=>g.executeCommand(w,"pipeline-console:open")}],autoClose:5e3}}};for(const e of o){const t=`\nimport time\ntime.sleep(0.25)\n${e.code}\n`;try{await g.executeKernelCodeWithNotifications(a.Notification,n.context.sessionContext.session,t,i),e.nodeId}catch(e){console.error(`Execution failed for code block: ${t}`,e);break}}}}),w.addCommand("pipeline-editor:version",{label:"About Amphi",execute:()=>{const{title:e,body:n}=function(){const e=h().createElement("span",{className:"jp-About-version-info"},h().createElement("span",{className:"jp-About-version"},"v","0.8.21")),n=h().createElement("span",{className:"jp-About-header"},h().createElement("img",{src:"https://amphi.ai/icons/amphi_logo_paths.svg",alt:"Amphi Logo",className:"amphi-logo",style:{height:"24px",marginRight:"10px",verticalAlign:"middle"}}),h().createElement("div",{className:"jp-About-header-info",style:{display:"inline-block",textAlign:"center"}},e)),t=h().createElement("span",{className:"jp-About-externalLinks"},h().createElement("a",{href:"https://amphi.ai",target:"_blank",rel:"noopener noreferrer",className:"jp-Button-flat"},"WEBSITE"),h().createElement("a",{href:"https://github.com/amphi-ai/amphi-etl",target:"_blank",rel:"noopener noreferrer",className:"jp-Button-flat"},"GITHUB")),o=h().createElement("span",{className:"jp-About-copyright"},"© 2024 Amphi");return{title:n,body:h().createElement("div",{className:"jp-About-body"},t,o)}}();return(0,a.showDialog)({title:e,body:n,buttons:[a.Dialog.createButton({label:"Close",className:"jp-About-button jp-mod-reject jp-mod-styled"})]})}}),e.contextMenu.addItem({command:X.create,selector:".jp-DirListing-content",rank:100}),n.addItem({command:X.create,category:"Pipeline",args:{isPalette:!0}}),n.addItem({command:"pipeline-editor:version",category:"Help",args:{isPalette:!0}}),w.addCommand("pipeline-editor-component:save-as-file",{execute:async n=>{const t=l(n);if(!t)return;const o=e.contextMenuHitTest((e=>!!e.dataset.id));if(o){const e=o.dataset.id,n=f.PipelineService.getNodeById(t.context.model.toString(),e),{data:a,type:i}=n,{lastUpdated:r,lastExecuted:s,...c}=a,l=JSON.stringify({component:{data:c,type:i}}),d=await w.execute("docmanager:new-untitled",{path:"/",type:"file",ext:".amcpn"}),p=await w.execute("docmanager:open",{path:d.path});await p.context.ready,p.context.model.fromString(l),await p.context.save(),await w.execute("docmanager:reload",{path:d.path}),await w.execute("docmanager:rename")}},label:"Save component"}),w.addCommand("pipeline-editor-component:view-data",{execute:async n=>{const t=l(n);if(!t)return;const o=e.contextMenuHitTest((e=>!!e.dataset.id));if(o){const n=o.dataset.id;await D(n,t.context,w,e)}t.nodeId&&await D(t.nodeId,t.context,w,e)},label:"Browse Data"}),w.addCommand("pipeline-editor-component:generate-ibis-code",{execute:async n=>{const t=l(n);if(!t)return;const o=e.contextMenuHitTest((e=>!!e.dataset.id));if(o){const e=o.dataset.id;console.log("nodeId %o",e),w.execute("pipeline-editor:run-pipeline-until",{nodeId:e,context:t.context}).then((n=>{const o=f.PipelineService.filterPipeline(t.context.model.toString()),{nodesToTraverse:a,nodesMap:i}=f.CodeGenerator.computeNodesToTraverse(o,e,v);if(console.log("nodesMap %o",i),console.log("nodesToTraverse %o",a),i.has(e)){const n=i[e];console.log("targetNode %o",n)}else console.error(`Node with ID ${e} not found in nodesMap`)})).catch((e=>{console.error(`Error with pipeline, nodes not updated.'.\n${e}`)}))}},label:"Generate SQL code"}),[{command:"pipeline-editor-component:save-as-file",selector:".component",rank:3},{command:"pipeline-editor-component:view-data",selector:".component",rank:4},{command:"pipeline-editor-component:generate-ibis-code",selector:".ibis",rank:7}].forEach((n=>{e.contextMenu.addItem({command:n.command,selector:n.selector,rank:n.rank})})),o&&o.add({command:X.create,category:"Amphi",rank:3})})).catch((e=>{console.error(`Something went wrong when reading the settings.\n${e}`)})),c&&c.restore(y,{command:"docmanager:open",args:e=>({path:e.context.path,factory:Y}),name:e=>e.context.path}),y}}]}}]);