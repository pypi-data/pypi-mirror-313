import{j as e,r as o}from"./@radix-DeK6qiuw.js";import{S as I}from"./plus-tf1V2hTJ.js";import{S as z}from"./refresh-BjOeWlEq.js";import{S as R,P as O}from"./SearchField-lp1KgU4e.js";import{s as f}from"./index-CEV4Cvaf.js";import{W as F,Z as L,$ as q,a0 as U,S as h,A as C,b as k,B as _,r as y,a8 as M,ag as B,ah as H,ai as $,F as Q,p as W,q as G,i as K,j as Z,ao as J,ap as V,aq as X,ar as Y,f as p,D as w,w as ee,x as se,at as te,z as u,L as ae}from"./index-CCOPpudF.js";import{a as N,b as re,c as ne}from"./@tanstack-DT5WLu9C.js";import{L as D,b as ie,c as le}from"./@react-router-B3Z5rLr2.js";import{C as b}from"./CopyButton-LNcWaa14.js";import{D as ce}from"./DisplayDate-CDMUcQHS.js";import{I as oe}from"./InlineAvatar-DiGOWNKF.js";import{C as g}from"./CodeSnippet-JzR8CEtw.js";import{C as de}from"./CollapsibleCard-DQW_ktMO.js";import{S as me}from"./chevron-right-double-D7ojK9Co.js";import{e as S}from"./components-Br2ezRib.js";import{s as xe}from"./url-CkvKAnwF.js";import{N as v}from"./NumberBox-Dtp3J6g5.js";import{C as ue}from"./ComponentBadge-D_g62Wv8.js";import{S as he}from"./dots-horizontal-otGBOSDJ.js";import{D as pe,S as fe}from"./DialogItem-Bxf8FuAT.js";import{S as je}from"./trash-arLUMWMS.js";import{I as ge}from"./Infobox-Cx4xGoXR.js";import{A as ye}from"./AlertDialogDropdownItem-DezXKmDf.js";function Ne(){return e.jsx("div",{className:"flex h-9 items-center border-b border-theme-border-moderate bg-theme-surface-primary px-4 py-3",children:e.jsxs(F,{className:"focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(me,{className:"h-5 w-5 fill-neutral-500"}),e.jsx("span",{className:"sr-only",children:"Close"})]})})}const A=o.createContext(null);function be({children:s}){const[t,a]=o.useState([]);return e.jsx(A.Provider,{value:{integrations:t,setIntegrations:a},children:s})}function T(){const s=o.useContext(A);if(s===null)throw new Error("useIntegrationsContext must be used within an AuthProvider");return s}function we({children:s,stackId:t,stackName:a}){return e.jsxs(L,{children:[e.jsx(q,{children:s}),e.jsx(U,{className:"w-[1000px] overflow-y-auto",children:e.jsxs(be,{children:[e.jsx(Ne,{}),e.jsx(Se,{stackId:t}),e.jsx(ke,{name:a}),e.jsx(ve,{stackId:t})]})})]})}function Se({stackId:s}){const t=N({...f.stackDetail(s)});return t.isError?null:t.isPending?e.jsx("div",{className:"p-5",children:e.jsx(h,{className:"h-6 w-full"})}):e.jsxs("div",{className:"flex items-center space-x-2 border-b border-theme-border-moderate bg-theme-surface-primary p-5",children:[e.jsx(C,{type:"square",size:"lg",children:e.jsx(k,{size:"lg",children:t.data.name[0]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[e.jsx("p",{className:"mb-0.5 text-text-sm text-theme-text-secondary",children:t.data.id}),e.jsx(b,{copyText:t.data.id})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("h2",{className:"text-display-xs font-semibold",children:t.data.name})})]})]})}function ve({stackId:s}){var n;const{setIntegrations:t}=T(),a=N({...f.stackDetail(s)});if(o.useEffect(()=>{var d;if(!a.data)return;const l=S((d=a.data.metadata)==null?void 0:d.components).map(c=>{var m;return(m=c.body)==null?void 0:m.integration}).filter(c=>!!c&&c!=="built-in"&&c!=="custom");l.length>=1&&t(c=>Array.from(new Set([...c,...l])))},[a.data]),a.isError)return null;if(a.isPending)return e.jsx("div",{className:"p-5",children:e.jsx(h,{className:"h-[300px] w-full"})});const r=S((n=a.data.metadata)==null?void 0:n.components);return e.jsx("ul",{className:"space-y-5 p-5",children:r.map(i=>e.jsx("li",{children:e.jsx(Ce,{component:i})},i.id))})}function Ce({component:s}){var t,a,r,n;return e.jsxs(_,{className:"flex items-center justify-between p-5",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{width:32,height:32,alt:`${(t=s.body)==null?void 0:t.flavor_name} logo`,src:xe(((a=s.body)==null?void 0:a.logo_url)||"")}),e.jsxs("div",{children:[e.jsx(D,{to:y.components.detail(s.id),className:"text-text-xl",children:s.name}),e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:s.id.split("-")[0]}),e.jsx(b,{copyText:s.id})]})]})]}),e.jsx(ue,{type:((r=s.body)==null?void 0:r.type)||"orchestrator",children:M(((n=s.body)==null?void 0:n.type)||"")})]})}function ke({name:s}){const{integrations:t}=T();return e.jsx("section",{className:"px-5 pt-5",children:e.jsx(de,{title:e.jsx("span",{className:"text-text-lg",children:"Set this stack"}),children:e.jsxs("ul",{className:"space-y-5",children:[e.jsxs("li",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{children:"1"}),e.jsx("p",{className:"font-semibold",children:"Set your stack"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Set the stack as active on your client"}),e.jsx(g,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml stack set ${s}`})]})]}),t.length>=1&&e.jsxs("li",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{children:"2"}),e.jsx("p",{className:"font-semibold",children:"Install the integrations"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Install the required integrations to run pipelines in your stack"}),e.jsx(g,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml integration install ${t.join(" ")}`})]})]})]})})})}const P=o.forwardRef(({closeModal:s,name:t,...a},r)=>e.jsxs(B,{...a,ref:r,children:[e.jsx(H,{children:e.jsx($,{children:"Update Stack"})}),e.jsxs("div",{className:"space-y-5 p-7",children:[e.jsx(De,{action:"update"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Update a stack"}),e.jsx(g,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml stack update ${t} -o NEW_ORCHESTRATOR_NAME`})]})]})]}));P.displayName="UpdateStackDialog";function De({action:s}){function t(){switch(s){case"delete":return"delete";case"update":return"update";case"describe":return"get details of"}}return e.jsx(ge,{children:e.jsx("div",{className:"flex w-full flex-wrap justify-between gap-2",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-text-sm font-semibold",children:"We are working on the new Stacks experience."}),e.jsxs("p",{className:"truncate text-text-sm",children:["Meanwhile you can use the CLI to ",t()," your stack."]})]})})})}async function Ae({stackId:s},t){const a=W(G.stacks.detail(s)),r=await fetch(a,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!r.ok){const n=await r.json().then(i=>Array.isArray(i.detail)?i.detail[1]:i.detail).catch(()=>`Error while deleting stack ${s}`);throw new Q({status:r.status,statusText:r.statusText,message:n})}return r.json()}function Te(s){return re({...s,mutationFn:async({stackId:t})=>Ae({stackId:t})})}function Pe(s){const{toast:t}=K(),a=ne(),r=ie(),n=Te({onSuccess:async()=>{a.invalidateQueries({queryKey:f.all}),r(y.stacks.overview)},onError:l=>{t({status:"error",emphasis:"subtle",icon:e.jsx(Z,{className:"h-5 w-5 shrink-0 fill-error-700"}),description:l.message,rounded:!0})}});function i(){n.mutate({stackId:s})}return{handleDelete:i,deleteStack:n}}const E=o.forwardRef(({closeModal:s,name:t,stackId:a,...r},n)=>{const{handleDelete:i,deleteStack:l}=Pe(a);return e.jsxs(J,{...r,className:"p-0",ref:n,children:[e.jsxs(V,{className:"m-0 py-2 pl-5 pr-3 text-text-lg font-semibold",children:["Delete ",t]}),e.jsx("div",{className:"border-y border-theme-border-moderate px-5 py-5",children:e.jsxs(X,{children:["Are you sure you want to delete this stack? ",e.jsx("br",{}),"This action cannot be undone."]})}),e.jsxs("div",{className:"flex justify-end gap-3 px-5 py-3",children:[e.jsx(Y,{onClick:()=>s==null?void 0:s(),asChild:!0,children:e.jsx(p,{intent:"secondary",children:"Cancel"})}),e.jsxs(p,{disabled:l.isPending,type:"button",onClick:()=>i(),intent:"danger",children:[l.isPending&&e.jsx("div",{role:"alert","aria-busy":"true",className:"full h-[20px] w-[20px] animate-spin rounded-rounded border-2 border-theme-text-negative border-b-theme-text-error"}),"Delete"]})]})]})});E.displayName="DeleteStackDialog";function Ee({name:s,id:t}){const[a,r]=o.useState(!1),[n,i]=o.useState(!1),l=o.useRef(null),d=o.useRef(null);function c(){d.current=l.current}function m(x){r(x),x===!1&&i(!1)}return e.jsx(w,{open:n,onOpenChange:i,children:e.jsxs(w,{children:[e.jsx(ee,{className:"z-10",ref:l,children:e.jsx(he,{className:"h-5 w-5 fill-theme-text-secondary"})}),e.jsxs(se,{hidden:a,onCloseAutoFocus:x=>{d.current&&(d.current.focus(),d.current=null,x.preventDefault())},className:"z-10",align:"end",sideOffset:1,children:[e.jsx(pe,{onSelect:c,onOpenChange:m,icon:e.jsx(fe,{className:"h-3 w-3 !fill-neutral-400"}),triggerChildren:"Update",children:e.jsx(P,{name:s,className:"lg:min-w-[600px]",closeModal:()=>m(!1)})}),e.jsx(ye,{onSelect:c,onOpenChange:m,icon:e.jsx(je,{className:"h-3  w-3 !fill-neutral-400"}),triggerChildren:"Delete",children:e.jsx(E,{stackId:t,name:s,className:"lg:min-w-[600px]",closeModal:()=>m(!1)})})]})]})})}function Ie(){return[{id:"name",header:"Stack",accessorFn:s=>({name:s.name,id:s.id}),cell:({getValue:s})=>{const{name:t,id:a}=s();return e.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[e.jsx(C,{type:"square",size:"md",children:e.jsx(k,{size:"md",children:t[0]})}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(we,{stackName:t,stackId:a,children:e.jsx("h2",{className:"text-text-md font-semibold",children:t})})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:a.split("-")[0]}),e.jsx(b,{copyText:a})]})]})]})}},{id:"created",header:"Created at",accessorFn:s=>{var t;return(t=s.body)==null?void 0:t.created},cell:({getValue:s})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(ce,{dateString:s()})})},{id:"author",header:"Author",accessorFn:s=>{var t;return{author:(t=s.body)==null?void 0:t.user}},cell:({getValue:s})=>{const{author:t}=s();return t?e.jsx(oe,{username:te(t)}):null}},{id:"actions",header:"",accessorFn:s=>({name:s.name,id:s.id}),cell:({getValue:s})=>{const{id:t,name:a}=s();return e.jsx(Ee,{name:a,id:t})}}]}const j=1,ze=u.object({page:u.coerce.number().min(j).optional().default(j).catch(j),name:u.string().optional(),operator:u.enum(["and","or"]).optional()});function Re(){const[s]=le(),{page:t,name:a,operator:r}=ze.parse({page:s.get("page")||void 0,name:s.get("name")||void 0});return{page:t,name:a,logical_operator:r}}function rs({fixedQueryParams:s={}}){const t=Re(),{refetch:a,data:r}=N({...f.stackList({...t,sort_by:"desc:updated",...s}),throwOnError:!0});return e.jsx("section",{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-4",children:[e.jsx(R,{searchParams:t}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs(p,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>a(),children:[e.jsx(z,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]}),e.jsx(p,{size:"md",asChild:!0,children:e.jsxs(D,{to:y.stacks.create.index,children:[e.jsx(I,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Stack"})]})})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:r?e.jsx(ae,{columns:Ie(),data:r.items}):e.jsx(h,{className:"h-[500px] w-full"})}),r?r.total_pages>1&&e.jsx(O,{searchParams:t,paginate:r}):e.jsx(h,{className:"h-[36px] w-[300px]"})]})]})})}export{rs as S};
