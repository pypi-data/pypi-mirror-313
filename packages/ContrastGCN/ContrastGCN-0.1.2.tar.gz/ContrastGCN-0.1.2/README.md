# ContrastGCN: An interpretable ensemble framework for automatic cell type annotation in single-cell chromatin accessibility data

## Quick Start

The main function `ContrastGCN.predict` can perform cell annotation, identification of new cell types, and model interpretation. If you do not wish to modify the parameter settings for the contrastive learning phase, you can conveniently use the ContrastGCN model by simply importing `ContrastGCN.predict`.

```python
from ContrastGCN import predict
```

### 1. Data

You should input the  scATAC-seq data as **AnnData** object. Make sure that the name of the cell row and the name of the peak column in training set and test set are identical.

### 2. Model

#### Cell Annotation

```python
predict(train_adata, test_adata, cell_row, peak_col, save_path=save_path)
```

| Parameters | Description                                                  |
| ---------- | ------------------------------------------------------------ |
| train_data | AnnData object of shape `n_obs` × `n_vars`.                  |
| test_data  | AnnData object of shape `n_obs` × `n_vars`.                  |
| cell_row   | the name of the cell row in AnnData.                         |
| peak_col   | the name of the peak column in AnnData.                      |
| save_path  | Represent the base directory path where results, models, and other output files should be saved. |

After execution, ContrastGCN will create a `ContrastGCN` folder in the specified `save_path`. This folder will contain the following outputs: `result.csv`, `report.csv`, `cl_model.pth`, and `gcn_model.pth`

| Output files  | Description                                                  |
| ------------- | ------------------------------------------------------------ |
| result.csv    | Stores the annotation results generated by ContrastGCN.      |
| report.csv    | Stores the model's performance scores based on four evaluation metrics. |
| cl_model.pth  | A saved model file containing the weights of the MLP trained during the contrastive learning phase. |
| gcn_model.pth | A saved model file containing the weights of the GCN trained during the GCN phase. |

#### Identify novel type

```python
predict(train_adata, test_adata, cell_row, peak_col, uncover_novel=True,save_path=save_pat)
```

Once `uncover_novel` is set to `True`, ContrastGCN renames the predictions in the test set that it identifies as novel types to `Novel type` and saves them in `result.csv`.

#### Interpretation Phase

```python
predict(train_adata, test_adata, cell_row, peak_col, explainer=True,save_path=save_pat)
```

Once `explainer` is set to `True`, ContrastGCN will iterate through all cell types in the training set, identify cell-type-specific peaks, and create a **DataFrame** with the column name `'peak'`, where each row stores the name of a peak. The **DataFrame** is saved as `cell-specific-peaks_of_{the name of the specific cell type}.csv`.